<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Beacon - Your AI Team for Rare Disease Treatment</title>

  <!-- React 18 + ReactDOM via CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Babel Standalone for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    /* Reset & Base Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', sans-serif;
      background: #faf8f5;
      color: #1f2937;
      line-height: 1.6;
      overflow-x: hidden;
    }

    /* Typography */
    h1 {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 1rem;
      color: #111827;
    }

    h2 {
      font-size: 2rem;
      font-weight: 600;
      margin-bottom: 0.75rem;
      color: #111827;
    }

    h3 {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: #1f2937;
    }

    p {
      font-size: 1.125rem;
      color: #4b5563;
      margin-bottom: 1rem;
    }

    /* Layout Containers */
    .stage {
      min-height: 100vh;
      padding: 3rem 2rem;
      opacity: 0;
      animation: fadeIn 0.6s ease-in forwards;
    }

    @keyframes fadeIn {
      to { opacity: 1; }
    }

    .container {
      max-width: 1280px;
      margin: 0 auto;
    }

    .container-narrow {
      max-width: 720px;
      margin: 0 auto;
    }

    .container-centered {
      max-width: 720px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 80vh;
      text-align: center;
    }

    /* Beacon Logo */
    .beacon-logo {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .beacon-icon {
      width: 80px;
      height: 80px;
      background: linear-gradient(135deg, #d97706 0%, #f59e0b 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.5rem;
      box-shadow: 0 10px 30px rgba(217, 119, 6, 0.3);
    }

    .beacon-title {
      font-size: 3rem;
      font-weight: 800;
      background: linear-gradient(135deg, #d97706 0%, #f59e0b 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* Buttons */
    .btn {
      padding: 1rem 2.5rem;
      font-size: 1.125rem;
      font-weight: 600;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .btn-primary {
      background: linear-gradient(135deg, #d97706 0%, #f59e0b 100%);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(217, 119, 6, 0.4);
    }

    .btn-secondary {
      background: white;
      color: #d97706;
      border: 2px solid #d97706;
    }

    .btn-secondary:hover {
      background: #fef3c7;
    }

    .btn-small {
      padding: 0.5rem 1.5rem;
      font-size: 0.95rem;
    }

    /* Input Fields */
    .input-field {
      width: 100%;
      padding: 1rem 1.5rem;
      font-size: 1.125rem;
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      margin-bottom: 1.5rem;
      transition: border-color 0.3s ease;
      background: white;
    }

    .input-field:focus {
      outline: none;
      border-color: #d97706;
    }

    /* Button Group */
    .button-group {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 1.5rem;
    }

    .btn-option {
      padding: 0.75rem 1.5rem;
      font-size: 1rem;
      background: white;
      border: 2px solid #e5e7eb;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-option:hover {
      border-color: #d97706;
      background: #fef3c7;
    }

    .btn-option.selected {
      background: #d97706;
      color: white;
      border-color: #d97706;
    }

    /* Checkbox Group */
    .checkbox-group {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      align-items: flex-start;
      margin-bottom: 2rem;
    }

    .checkbox-label {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-size: 1.125rem;
      cursor: pointer;
      padding: 0.5rem;
    }

    .checkbox-label input {
      width: 24px;
      height: 24px;
      cursor: pointer;
    }

    /* Intake Questions */
    .intake-question {
      margin-bottom: 3rem;
      opacity: 0;
      animation: slideInUp 0.5s ease-out forwards;
    }

    @keyframes slideInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .question-label {
      font-size: 1.5rem;
      font-weight: 600;
      color: #111827;
      margin-bottom: 1.5rem;
      display: block;
    }

    /* Agent Cards */
    .agent-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 2rem;
      margin-bottom: 3rem;
    }

    .agent-card {
      background: white;
      border-radius: 16px;
      padding: 2rem;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      opacity: 0;
      animation: cardAppear 0.6s ease-out forwards;
      transition: transform 0.3s ease;
    }

    .agent-card:hover {
      transform: translateY(-4px);
    }

    .agent-card:nth-child(1) { animation-delay: 0s; }
    .agent-card:nth-child(2) { animation-delay: 0.3s; }
    .agent-card:nth-child(3) { animation-delay: 0.6s; }
    .agent-card:nth-child(4) { animation-delay: 0.9s; }
    .agent-card:nth-child(5) { animation-delay: 1.2s; }

    @keyframes cardAppear {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .agent-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
    }

    .agent-name {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      color: #111827;
    }

    .agent-role {
      font-size: 1rem;
      font-weight: 600;
      color: #6b7280;
      margin-bottom: 1rem;
    }

    .agent-description {
      font-size: 1rem;
      color: #4b5563;
      line-height: 1.5;
    }

    /* Agent Colors */
    .agent-card.scout { border-top: 4px solid #8b5cf6; }
    .agent-card.connector { border-top: 4px solid #ec4899; }
    .agent-card.navigator { border-top: 4px solid #3b82f6; }
    .agent-card.mobilizer { border-top: 4px solid #10b981; }
    .agent-card.strategist { border-top: 4px solid #f59e0b; }

    /* Launch Status Panels */
    .status-grid {
      display: grid;
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .status-panel {
      background: white;
      border-radius: 16px;
      padding: 2rem;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
    }

    .status-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .status-icon {
      font-size: 2rem;
    }

    .status-info h3 {
      font-size: 1.25rem;
      margin-bottom: 0.25rem;
    }

    .status-label {
      font-size: 0.95rem;
      color: #6b7280;
      font-weight: 500;
    }

    .status-label.working {
      color: #d97706;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .status-updates {
      list-style: none;
      font-family: 'SF Mono', 'Monaco', 'Courier New', monospace;
      font-size: 0.95rem;
    }

    .status-update {
      padding: 0.5rem 0;
      color: #4b5563;
      opacity: 0;
      animation: fadeSlideIn 0.4s ease-out forwards;
    }

    @keyframes fadeSlideIn {
      from {
        opacity: 0;
        transform: translateX(-10px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .status-update.completed {
      color: #10b981;
    }

    .status-update.finding {
      color: #d97706;
      font-weight: 600;
    }

    /* Header Bar */
    .header-bar {
      background: white;
      border-bottom: 2px solid #f3f4f6;
      padding: 1.5rem 2rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
    }

    .header-title {
      display: flex;
      align-items: center;
      gap: 1rem;
      font-size: 1.5rem;
      font-weight: 700;
    }

    .header-icon {
      font-size: 1.75rem;
    }

    .notification-badge {
      background: #d97706;
      color: white;
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: 600;
    }

    /* Timeline */
    .timeline {
      display: flex;
      justify-content: space-between;
      margin: 3rem 0;
      position: relative;
      padding: 2rem 0;
    }

    .timeline::before {
      content: '';
      position: absolute;
      top: 2.5rem;
      left: 0;
      right: 0;
      height: 4px;
      background: #e5e7eb;
      z-index: 0;
    }

    .timeline-phase {
      flex: 1;
      position: relative;
      z-index: 1;
    }

    .timeline-marker {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: white;
      border: 4px solid #e5e7eb;
      margin: 0 auto 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
    }

    .timeline-phase.active .timeline-marker {
      background: #d97706;
      border-color: #d97706;
      color: white;
    }

    .timeline-label {
      font-weight: 600;
      font-size: 0.95rem;
      text-align: center;
      color: #6b7280;
      margin-bottom: 0.5rem;
    }

    .timeline-phase.active .timeline-label {
      color: #d97706;
    }

    .timeline-title {
      font-weight: 700;
      font-size: 1.1rem;
      text-align: center;
      margin-bottom: 1rem;
    }

    .timeline-milestones {
      list-style: none;
      font-size: 0.9rem;
      color: #6b7280;
      text-align: center;
    }

    .timeline-milestones li {
      margin-bottom: 0.5rem;
    }

    /* Priorities Section */
    .priorities-section {
      background: white;
      border-radius: 16px;
      padding: 2rem;
      margin: 3rem 0;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    }

    .priority-list {
      list-style: none;
      counter-reset: priority-counter;
    }

    .priority-item {
      counter-increment: priority-counter;
      position: relative;
      padding-left: 3rem;
      margin-bottom: 1.5rem;
      font-size: 1.1rem;
    }

    .priority-item::before {
      content: counter(priority-counter);
      position: absolute;
      left: 0;
      top: 0;
      width: 2rem;
      height: 2rem;
      background: #d97706;
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
    }

    /* Mission Control Layout */
    .mission-control {
      padding: 2rem;
    }

    .attention-section {
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
      border-radius: 16px;
      padding: 2rem;
      margin-bottom: 2rem;
      border-left: 6px solid #d97706;
    }

    .approval-cards {
      display: grid;
      gap: 1rem;
      margin-top: 1.5rem;
    }

    .approval-card {
      background: white;
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .approval-info {
      flex: 1;
    }

    .approval-badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: 6px;
      font-size: 0.85rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      background: #dbeafe;
      color: #1e40af;
    }

    .approval-title {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .approval-summary {
      font-size: 0.95rem;
      color: #6b7280;
    }

    .main-grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 2rem;
      margin-bottom: 2rem;
    }

    .feed-section {
      background: white;
      border-radius: 16px;
      padding: 2rem;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
    }

    .feed-items {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      margin-top: 1.5rem;
    }

    .feed-item {
      padding: 1.5rem;
      border-radius: 12px;
      background: #fafafa;
      border-left: 4px solid #d97706;
      opacity: 0;
      animation: fadeSlideIn 0.5s ease-out forwards;
    }

    .feed-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }

    .feed-agent {
      font-weight: 600;
      font-size: 0.95rem;
    }

    .feed-time {
      color: #9ca3af;
      font-size: 0.85rem;
    }

    .feed-title {
      font-weight: 600;
      font-size: 1.1rem;
      margin-bottom: 0.5rem;
    }

    .feed-summary {
      font-size: 0.95rem;
      color: #4b5563;
      margin-bottom: 0.75rem;
    }

    .significance-badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: 6px;
      font-size: 0.85rem;
      font-weight: 600;
      background: #dcfce7;
      color: #166534;
    }

    .agent-status-section {
      background: white;
      border-radius: 16px;
      padding: 2rem;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
      height: fit-content;
    }

    .agent-status-list {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-top: 1.5rem;
    }

    .agent-status-row {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .status-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .status-dot.complete { background: #10b981; }
    .status-dot.working { background: #f59e0b; animation: pulse 2s ease-in-out infinite; }
    .status-dot.idle { background: #9ca3af; }

    .agent-status-info {
      flex: 1;
    }

    .agent-status-name {
      font-weight: 600;
      font-size: 0.95rem;
      margin-bottom: 0.25rem;
    }

    .agent-status-task {
      font-size: 0.85rem;
      color: #6b7280;
    }

    .progress-section {
      background: white;
      border-radius: 16px;
      padding: 2rem;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
    }

    .progress-bars {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      margin-top: 1.5rem;
    }

    .progress-bar-item {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .progress-label {
      display: flex;
      justify-content: space-between;
      font-size: 0.95rem;
      font-weight: 600;
    }

    .progress-bar-bg {
      height: 12px;
      background: #f3f4f6;
      border-radius: 6px;
      overflow: hidden;
    }

    .progress-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, #d97706 0%, #f59e0b 100%);
      border-radius: 6px;
      transition: width 0.5s ease;
    }

    .chat-input-section {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      border-top: 2px solid #f3f4f6;
      padding: 1.5rem 2rem;
      box-shadow: 0 -2px 12px rgba(0, 0, 0, 0.06);
    }

    .chat-input-wrapper {
      max-width: 1280px;
      margin: 0 auto;
      display: flex;
      gap: 1rem;
    }

    .chat-input {
      flex: 1;
      padding: 1rem 1.5rem;
      font-size: 1rem;
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      background: #fafafa;
    }

    .chat-input:focus {
      outline: none;
      border-color: #d97706;
      background: white;
    }

    /* Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      animation: fadeIn 0.3s ease-out forwards;
    }

    .modal {
      background: white;
      border-radius: 20px;
      padding: 2.5rem;
      max-width: 700px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      transform: scale(0.9);
      animation: modalAppear 0.3s ease-out forwards;
    }

    @keyframes modalAppear {
      to {
        transform: scale(1);
      }
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }

    .modal-title {
      font-size: 1.75rem;
      font-weight: 700;
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #9ca3af;
      transition: color 0.2s;
    }

    .modal-close:hover {
      color: #1f2937;
    }

    .modal-field {
      margin-bottom: 1.5rem;
    }

    .modal-label {
      display: block;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: #374151;
    }

    .modal-input {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      font-size: 1rem;
    }

    .modal-textarea {
      width: 100%;
      padding: 1rem;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      font-size: 1rem;
      min-height: 200px;
      font-family: inherit;
      resize: vertical;
    }

    .modal-input:focus,
    .modal-textarea:focus {
      outline: none;
      border-color: #d97706;
    }

    .modal-note {
      background: #fef3c7;
      padding: 1rem;
      border-radius: 8px;
      border-left: 4px solid #d97706;
      margin-bottom: 1.5rem;
    }

    .modal-note-label {
      font-weight: 600;
      font-size: 0.9rem;
      color: #92400e;
      margin-bottom: 0.5rem;
    }

    .modal-note-text {
      font-size: 0.95rem;
      color: #78350f;
    }

    .modal-actions {
      display: flex;
      gap: 1rem;
      margin-top: 2rem;
    }

    .btn-approve {
      background: #10b981;
      color: white;
    }

    .btn-approve:hover {
      background: #059669;
    }

    .btn-cancel {
      background: #e5e7eb;
      color: #374151;
    }

    .btn-cancel:hover {
      background: #d1d5db;
    }

    /* Utility Classes */
    .text-center {
      text-align: center;
    }

    .mt-2 { margin-top: 2rem; }
    .mt-3 { margin-top: 3rem; }
    .mb-2 { margin-bottom: 2rem; }
    .mb-3 { margin-bottom: 3rem; }

    /* Typeahead */
    .typeahead-wrapper {
      position: relative;
      width: 100%;
    }

    .typeahead-input-wrapper {
      position: relative;
    }

    .typeahead-icon {
      position: absolute;
      left: 1.25rem;
      top: 50%;
      transform: translateY(-50%);
      font-size: 1.1rem;
      pointer-events: none;
      z-index: 1;
    }

    .typeahead-input {
      padding-left: 3rem !important;
    }

    .typeahead-dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: white;
      border: 2px solid #e5e7eb;
      border-top: none;
      border-radius: 0 0 12px 12px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
      z-index: 100;
      max-height: 360px;
      overflow-y: auto;
      animation: dropdownAppear 0.2s ease-out;
    }

    @keyframes dropdownAppear {
      from { opacity: 0; transform: translateY(-4px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .typeahead-option {
      padding: 0.85rem 1.25rem;
      cursor: pointer;
      transition: background 0.15s;
      border-bottom: 1px solid #f3f4f6;
      text-align: left;
    }

    .typeahead-option:last-child {
      border-bottom: none;
    }

    .typeahead-option:hover {
      background: #fef3c7;
    }

    .typeahead-option-name {
      font-size: 1.05rem;
      font-weight: 600;
      color: #111827;
      margin-bottom: 0.15rem;
    }

    .typeahead-option-aliases {
      font-size: 0.85rem;
      color: #9ca3af;
    }

    /* Focus Area Cards */
    .focus-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      width: 100%;
      max-width: 600px;
      margin-bottom: 1rem;
    }

    .focus-card {
      background: white;
      border: 2px solid #e5e7eb;
      border-radius: 14px;
      padding: 1.5rem 1.25rem;
      cursor: pointer;
      transition: all 0.25s ease;
      text-align: left;
    }

    .focus-card:hover {
      border-color: #d97706;
      background: #fffbeb;
    }

    .focus-card.selected {
      border-color: #d97706;
      background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
      box-shadow: 0 4px 12px rgba(217, 119, 6, 0.15);
    }

    .focus-card-all {
      width: 100%;
      max-width: 600px;
      text-align: center;
      border-style: dashed;
    }

    .focus-card-all.selected {
      border-style: solid;
    }

    .focus-card-icon {
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }

    .focus-card-title {
      font-size: 1.1rem;
      font-weight: 700;
      color: #111827;
      margin-bottom: 0.35rem;
    }

    .focus-card-desc {
      font-size: 0.9rem;
      color: #6b7280;
      line-height: 1.4;
    }

    /* Launch Notify Card */
    .launch-notify {
      background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
      border-radius: 16px;
      padding: 2rem 2.5rem;
      margin-bottom: 2rem;
      text-align: center;
      box-shadow: 0 2px 12px rgba(217, 119, 6, 0.1);
    }

    .launch-notify h2 {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
    }

    .launch-notify p {
      color: #78350f;
      margin-bottom: 1.25rem;
    }

    .launch-notify-form {
      display: flex;
      gap: 0.75rem;
      justify-content: center;
      max-width: 480px;
      margin: 0 auto;
    }

    .launch-notify-form input {
      flex: 1;
      padding: 0.75rem 1rem;
      border: 2px solid #e5e7eb;
      border-radius: 10px;
      font-size: 1rem;
      background: white;
    }

    .launch-notify-form input:focus {
      outline: none;
      border-color: #d97706;
    }

    .launch-notify-success {
      color: #166534;
      font-weight: 600;
      font-size: 1.05rem;
    }

    /* Overall Progress Bar */
    .launch-progress-bar {
      background: white;
      border-radius: 16px;
      padding: 1.5rem 2rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
    }

    .launch-progress-bar .progress-text {
      font-weight: 600;
      font-size: 1.05rem;
      color: #374151;
      margin-bottom: 0.75rem;
    }

    .launch-progress-track {
      height: 14px;
      background: #f3f4f6;
      border-radius: 7px;
      overflow: hidden;
    }

    .launch-progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #d97706 0%, #f59e0b 100%);
      border-radius: 7px;
      transition: width 0.6s ease;
    }

    /* Agent Circles Row */
    .agent-circles {
      display: flex;
      justify-content: center;
      gap: 1.5rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
    }

    .agent-circle {
      position: relative;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      transition: all 0.25s ease;
      border: 3px solid transparent;
    }

    .agent-circle:hover {
      transform: scale(1.1);
    }

    .agent-circle.expanded {
      border-color: #d97706;
      box-shadow: 0 4px 16px rgba(217, 119, 6, 0.25);
    }

    .agent-circle-dot {
      position: absolute;
      bottom: -2px;
      right: -2px;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      border: 2px solid white;
    }

    .agent-circle-dot.complete { background: #10b981; }
    .agent-circle-dot.working { background: #f59e0b; animation: pulse 2s ease-in-out infinite; }
    .agent-circle-dot.idle { background: #d1d5db; }

    .agent-circle-name {
      position: absolute;
      bottom: -22px;
      font-size: 0.7rem;
      font-weight: 600;
      color: #6b7280;
      white-space: nowrap;
    }

    /* Agent Detail Panel (expandable) */
    .agent-detail-panel {
      background: white;
      border-radius: 16px;
      padding: 1.5rem 2rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
      animation: fadeSlideIn 0.3s ease-out forwards;
    }

    /* Countdown Banner */
    .countdown-banner {
      background: linear-gradient(135deg, #d97706 0%, #f59e0b 100%);
      color: white;
      padding: 1rem 2rem;
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1.5rem;
      margin-bottom: 2rem;
      font-size: 1.15rem;
      font-weight: 600;
      animation: fadeIn 0.4s ease-out forwards;
    }

    .countdown-banner button {
      background: rgba(255,255,255,0.25);
      border: 2px solid white;
      color: white;
      padding: 0.4rem 1rem;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.9rem;
      transition: background 0.2s;
    }

    .countdown-banner button:hover {
      background: rgba(255,255,255,0.4);
    }

    /* Loading Animation */
    .loading-spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    /* ===== Mobile Responsive ===== */
    @media (max-width: 768px) {
      h1 { font-size: 1.75rem; }
      h2 { font-size: 1.5rem; }
      h3 { font-size: 1.25rem; }
      p { font-size: 1rem; }

      .stage { padding: 2rem 1rem; }

      .container-centered {
        min-height: auto;
        padding: 2rem 0;
      }

      .beacon-icon { width: 56px; height: 56px; font-size: 1.75rem; }
      .beacon-title { font-size: 2rem; }
      .beacon-logo { gap: 0.75rem; margin-bottom: 1.5rem; }

      /* Buttons */
      .btn { padding: 0.85rem 1.75rem; font-size: 1rem; }

      /* Agent grid */
      .agent-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
      }

      .agent-card { padding: 1.5rem; }
      .agent-icon { font-size: 2rem; }
      .agent-name { font-size: 1.25rem; }

      /* Focus area cards */
      .focus-grid {
        grid-template-columns: 1fr;
        gap: 0.75rem;
      }

      .focus-card { padding: 1.25rem 1rem; }
      .focus-card-icon { font-size: 1.5rem; }

      /* Timeline */
      .timeline {
        flex-direction: column;
        gap: 2rem;
        padding: 1rem 0;
      }

      .timeline::before {
        display: none;
      }

      .timeline-phase {
        display: flex;
        align-items: flex-start;
        gap: 1rem;
        text-align: left;
      }

      .timeline-marker {
        margin: 0;
        flex-shrink: 0;
      }

      .timeline-label,
      .timeline-title,
      .timeline-milestones { text-align: left; }

      /* Mission control */
      .main-grid {
        grid-template-columns: 1fr;
      }

      .header-bar {
        padding: 1rem;
        flex-wrap: wrap;
        gap: 0.5rem;
      }

      .header-title { font-size: 1.15rem; }

      .mission-control { padding: 1rem; }

      .attention-section { padding: 1.25rem; }

      .approval-card {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
      }

      /* Chat input */
      .chat-input-section { padding: 1rem; }
      .chat-input-wrapper { flex-direction: column; }
      .chat-input { font-size: 1rem; }

      /* Launch notify */
      .launch-notify { padding: 1.5rem 1rem; }
      .launch-notify-form { flex-direction: column; }
      .agent-circles { gap: 1rem; }
      .agent-circle { width: 48px; height: 48px; font-size: 1.25rem; }
      .countdown-banner { flex-direction: column; gap: 0.75rem; font-size: 1rem; }

      /* Status panels */
      .status-panel { padding: 1.25rem; }

      /* Modal */
      .modal {
        padding: 1.5rem;
        width: 95%;
        border-radius: 16px;
      }

      .modal-actions {
        flex-direction: column;
      }

      .modal-actions .btn { width: 100%; text-align: center; }

      /* Priorities section */
      .priorities-section { padding: 1.25rem; }
      .priority-item { font-size: 1rem; }
    }

    @media (max-width: 480px) {
      h1 { font-size: 1.4rem; }
      .beacon-title { font-size: 1.6rem; }
      .beacon-icon { width: 44px; height: 44px; font-size: 1.4rem; }
      .question-label { font-size: 1.25rem; }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useCallback } = React;

    // Main App Component
    function App() {
      const [stage, setStage] = useState('welcome');
      const [mission, setMission] = useState({
        disease: '',
        priorities: []
      });
      const [state, setState] = useState(null);
      const [scoutReport, setScoutReport] = useState(null);
      const [connectorReport, setConnectorReport] = useState(null);
      const [navigatorReport, setNavigatorReport] = useState(null);
      const [mobilizerReport, setMobilizerReport] = useState(null);
      const [strategistBriefing, setStrategistBriefing] = useState(null);
      const [modalOpen, setModalOpen] = useState(false);
      const [selectedApproval, setSelectedApproval] = useState(null);

      // Hash-based routing
      useEffect(() => {
        const handleHashChange = () => {
          const hash = window.location.hash.slice(1) || 'welcome';
          setStage(hash);
        };

        window.addEventListener('hashchange', handleHashChange);
        handleHashChange();

        return () => window.removeEventListener('hashchange', handleHashChange);
      }, []);

      // Helper to fetch and unwrap JSON (handles Claude CLI envelope and markdown fences)
      const fetchReport = async (url) => {
        try {
          const res = await fetch(url);
          if (!res.ok) return null;
          const text = await res.text();
          let data;
          try {
            data = JSON.parse(text);
          } catch {
            // Try stripping markdown fences
            const match = text.match(/```(?:json)?\s*([\s\S]*?)```/);
            if (match) data = JSON.parse(match[1]);
            else return null;
          }
          // Unwrap Claude CLI envelope
          if (data && data.type === 'result' && typeof data.result === 'string') {
            try { return JSON.parse(data.result); } catch { return null; }
          }
          return data;
        } catch { return null; }
      };

      const demo = isDemo();

      // In demo mode, pre-populate mission data
      useEffect(() => {
        if (demo && !mission.disease) {
          setMission({ disease: 'Batten Disease (CLN3)', priorities: ['research', 'experts', 'regulatory', 'funding'] });
        }
      }, [demo]);

      // Demo mode: set pre-baked data when reaching mission control
      useEffect(() => {
        if (demo && (stage === 'roadmap' || stage === 'mission')) {
          setState({
            mission: { disease: 'CLN3 Batten Disease' },
            agents: {
              scout: { status: 'complete', current_task: 'Monitoring new publications' },
              connector: { status: 'working', current_task: 'Awaiting response from Dr. Cooper' },
              navigator: { status: 'complete', current_task: 'Pathway mapped' },
              mobilizer: { status: 'working', current_task: 'Drafting CZI grant application' },
              strategist: { status: 'complete', current_task: 'Weekly briefing ready' },
            },
            approvals: [
              {
                type: 'Outreach Email',
                title: 'Email to Dr. Jonathan Cooper ‚Äî Weill Cornell',
                summary: 'Personalized introduction about your family\'s CLN3 journey and interest in his AAV9 gene therapy research.',
                to: 'jonathan.cooper@weillcornell.edu',
                subject: 'Parent of CLN3 patient ‚Äî interested in your gene therapy research',
                body: 'Dear Dr. Cooper,\n\nI am writing as a parent of a child recently diagnosed with CLN3 Batten Disease. I\'ve been following your groundbreaking work on AAV9-mediated gene therapy for neuronal ceroid lipofuscinoses with great interest.\n\nYour 2024 paper on intrathecal delivery showing restored CLN3 protein expression in the murine model was particularly encouraging. I would be grateful for the opportunity to discuss your research and learn about any upcoming clinical trial opportunities.\n\nWould you be available for a brief conversation?\n\nWith hope,\n[Your name]',
                note: 'Dr. Cooper leads the only active AAV9-CLN3 gene therapy program. His lab published promising preclinical results in 2024. High priority contact.',
                reviewed: false,
              }
            ]
          });
          setScoutReport({
            findings: [
              { title: 'AAV9-CLN3 Gene Therapy ‚Äî Phase I/II Trial', summary: 'Weill Cornell team enrolling patients for intrathecal AAV9 delivery targeting CLN3 protein restoration. First-in-human data expected Q3 2026.', significance: 'Breakthrough' },
              { title: 'Small Molecule TRPML1 Activator', summary: 'New paper demonstrates lysosomal calcium channel activation as potential therapeutic target. Early-stage but mechanistically promising.', significance: 'High Impact' },
              { title: 'Antisense Oligonucleotide Approach', summary: 'Ionis Pharmaceuticals exploring ASO-based strategy for CLN3 splicing correction. Preclinical stage.', significance: 'Emerging' },
            ]
          });
          setConnectorReport({
            contacts: [
              { name: 'Dr. Jonathan Cooper', institution: 'Weill Cornell Medicine ‚Äî Gene Therapy Lab' },
              { name: 'Dr. Sara Bhatt', institution: 'UCL Great Ormond Street ‚Äî NCL Research Group' },
              { name: 'Dr. Mark Bhatt', institution: 'Nationwide Children\'s Hospital ‚Äî Rare Disease Center' },
            ]
          });
          return;
        }
      }, [demo, stage]);

      // Data polling for mission control (non-demo mode)
      useEffect(() => {
        if (demo) return;
        if (stage === 'launch' || stage === 'mission') {
          const pollData = async () => {
            try {
              const stateRes = await fetch('data/state.json');
              if (stateRes.ok) setState(await stateRes.json());
            } catch (e) {}

            const scout = await fetchReport('data/scout-report.json');
            if (scout) setScoutReport(scout);

            const connector = await fetchReport('data/connector-report.json');
            if (connector) setConnectorReport(connector);

            const navigator = await fetchReport('data/navigator-report.json');
            if (navigator) setNavigatorReport(navigator);

            const mobilizer = await fetchReport('data/mobilizer-report.json');
            if (mobilizer) setMobilizerReport(mobilizer);

            const strategist = await fetchReport('data/strategist-briefing.json');
            if (strategist) setStrategistBriefing(strategist);
          };

          pollData();
          const interval = setInterval(pollData, 2000);
          return () => clearInterval(interval);
        }
      }, [stage, demo]);

      const navigateTo = (newStage) => {
        window.location.hash = newStage;
      };

      const renderStage = () => {
        switch (stage) {
          case 'welcome':
            return <WelcomeStage mission={mission} setMission={setMission} navigateTo={navigateTo} />;
          case 'team':
            return <TeamStage navigateTo={navigateTo} />;
          case 'launch':
            return <LaunchStage state={state} navigateTo={navigateTo} />;
          case 'roadmap':
            return <RoadmapStage mission={mission} navigateTo={navigateTo} />;
          case 'mission':
            return (
              <MissionControlStage
                mission={mission}
                state={state}
                scoutReport={scoutReport}
                connectorReport={connectorReport}
                navigatorReport={navigatorReport}
                mobilizerReport={mobilizerReport}
                strategistBriefing={strategistBriefing}
                setModalOpen={setModalOpen}
                setSelectedApproval={setSelectedApproval}
              />
            );
          default:
            return <WelcomeStage mission={mission} setMission={setMission} navigateTo={navigateTo} />;
        }
      };

      return (
        <>
          {renderStage()}
          {modalOpen && selectedApproval && (
            <ApprovalModal
              approval={selectedApproval}
              onClose={() => setModalOpen(false)}
            />
          )}
        </>
      );
    }

    // Curated rare disease list for typeahead
    const RARE_DISEASES = [
      { name: "Batten Disease (CLN3)", aliases: ["CLN3", "Juvenile Neuronal Ceroid Lipofuscinosis", "JNCL", "Batten Disease"] },
      { name: "Batten Disease (CLN1)", aliases: ["CLN1", "Infantile Neuronal Ceroid Lipofuscinosis"] },
      { name: "Batten Disease (CLN2)", aliases: ["CLN2", "Late Infantile Neuronal Ceroid Lipofuscinosis", "TPP1 Deficiency"] },
      { name: "Spinal Muscular Atrophy (SMA)", aliases: ["SMA", "Werdnig-Hoffmann Disease"] },
      { name: "Duchenne Muscular Dystrophy", aliases: ["DMD", "Duchenne"] },
      { name: "Cystic Fibrosis", aliases: ["CF", "Mucoviscidosis"] },
      { name: "Huntington's Disease", aliases: ["HD", "Huntington Chorea"] },
      { name: "Rett Syndrome", aliases: ["MECP2", "Rett"] },
      { name: "Dravet Syndrome", aliases: ["SCN1A", "Severe Myoclonic Epilepsy of Infancy", "SMEI"] },
      { name: "Fragile X Syndrome", aliases: ["FXS", "Martin-Bell Syndrome"] },
      { name: "Tay-Sachs Disease", aliases: ["Hexosaminidase A Deficiency", "GM2 Gangliosidosis"] },
      { name: "Gaucher Disease", aliases: ["Glucocerebrosidase Deficiency"] },
      { name: "Pompe Disease", aliases: ["Glycogen Storage Disease Type II", "Acid Maltase Deficiency"] },
      { name: "Fabry Disease", aliases: ["Alpha-Galactosidase A Deficiency", "Anderson-Fabry Disease"] },
      { name: "Phenylketonuria (PKU)", aliases: ["PKU", "Phenylalanine Hydroxylase Deficiency"] },
      { name: "Niemann-Pick Disease", aliases: ["NPD", "Sphingomyelinase Deficiency"] },
      { name: "Angelman Syndrome", aliases: ["AS", "Happy Puppet Syndrome"] },
      { name: "Prader-Willi Syndrome", aliases: ["PWS"] },
      { name: "Williams Syndrome", aliases: ["Williams-Beuren Syndrome", "WBS"] },
      { name: "Marfan Syndrome", aliases: ["FBN1", "Marfan"] },
      { name: "Ehlers-Danlos Syndrome", aliases: ["EDS", "Hypermobility"] },
      { name: "Tuberous Sclerosis Complex", aliases: ["TSC", "Tuberous Sclerosis"] },
      { name: "Sickle Cell Disease", aliases: ["SCD", "Sickle Cell Anemia"] },
      { name: "Thalassemia", aliases: ["Cooley's Anemia", "Mediterranean Anemia"] },
      { name: "Hemophilia A", aliases: ["Factor VIII Deficiency", "Classic Hemophilia"] },
      { name: "Hemophilia B", aliases: ["Factor IX Deficiency", "Christmas Disease"] },
      { name: "Charcot-Marie-Tooth Disease", aliases: ["CMT", "Hereditary Motor Sensory Neuropathy"] },
      { name: "Friedreich's Ataxia", aliases: ["FA", "FRDA"] },
      { name: "Amyotrophic Lateral Sclerosis (ALS)", aliases: ["ALS", "Lou Gehrig's Disease", "Motor Neurone Disease"] },
      { name: "Wilson's Disease", aliases: ["Hepatolenticular Degeneration"] },
      { name: "Epidermolysis Bullosa", aliases: ["EB", "Butterfly Disease"] },
      { name: "Progeria", aliases: ["Hutchinson-Gilford Progeria Syndrome", "HGPS"] },
      { name: "Osteogenesis Imperfecta", aliases: ["OI", "Brittle Bone Disease"] },
      { name: "Achondroplasia", aliases: ["Dwarfism", "ACH"] },
      { name: "Krabbe Disease", aliases: ["Globoid Cell Leukodystrophy", "Galactosylceramidase Deficiency"] },
      { name: "Adrenoleukodystrophy (ALD)", aliases: ["ALD", "X-linked ALD", "Lorenzo's Oil Disease"] },
      { name: "Metachromatic Leukodystrophy", aliases: ["MLD", "Arylsulfatase A Deficiency"] },
      { name: "Canavan Disease", aliases: ["Aspartoacylase Deficiency", "Spongy Degeneration"] },
      { name: "Alexander Disease", aliases: ["AxD", "Fibrinoid Leukodystrophy"] },
      { name: "Zellweger Spectrum Disorder", aliases: ["ZSD", "Peroxisomal Biogenesis Disorders"] },
      { name: "CDKL5 Deficiency Disorder", aliases: ["CDKL5", "CDD"] },
      { name: "Sanfilippo Syndrome", aliases: ["MPS III", "Mucopolysaccharidosis Type III"] },
      { name: "Hunter Syndrome", aliases: ["MPS II", "Mucopolysaccharidosis Type II"] },
      { name: "Hurler Syndrome", aliases: ["MPS I", "Mucopolysaccharidosis Type I"] },
      { name: "Leigh Syndrome", aliases: ["Subacute Necrotizing Encephalomyelopathy"] },
      { name: "AADC Deficiency", aliases: ["Aromatic L-Amino Acid Decarboxylase Deficiency"] },
      { name: "Giant Axonal Neuropathy", aliases: ["GAN"] },
      { name: "Ataxia-Telangiectasia", aliases: ["A-T", "Louis-Bar Syndrome"] },
      { name: "Cockayne Syndrome", aliases: ["CS", "Neill-Dingwall Syndrome"] },
      { name: "Alagille Syndrome", aliases: ["ALGS", "Arteriohepatic Dysplasia"] },
    ];

    // Stage 1: Welcome
    function WelcomeStage({ mission, setMission, navigateTo }) {
      const [step, setStep] = useState(0);
      const [searchQuery, setSearchQuery] = useState('');
      const [showDropdown, setShowDropdown] = useState(false);
      const [filteredDiseases, setFilteredDiseases] = useState([]);

      const handleSearchChange = (e) => {
        const query = e.target.value;
        setSearchQuery(query);
        setMission({ ...mission, disease: query });

        if (query.trim().length > 0) {
          const q = query.toLowerCase();
          const matches = RARE_DISEASES.filter(d =>
            d.name.toLowerCase().includes(q) ||
            d.aliases.some(a => a.toLowerCase().includes(q))
          ).slice(0, 8);
          setFilteredDiseases(matches);
          setShowDropdown(true);
        } else {
          setFilteredDiseases([]);
          setShowDropdown(false);
        }
      };

      const selectDisease = (disease) => {
        setSearchQuery(disease.name);
        setMission({ ...mission, disease: disease.name });
        setShowDropdown(false);
        setStep(1);
      };

      const handleDiseaseSubmit = (e) => {
        e.preventDefault();
        if (mission.disease.trim()) {
          setShowDropdown(false);
          setStep(1);
        }
      };

      const highlightMatch = (text, query) => {
        if (!query) return text;
        const idx = text.toLowerCase().indexOf(query.toLowerCase());
        if (idx === -1) return text;
        return React.createElement('span', null,
          text.slice(0, idx),
          React.createElement('strong', { style: { color: '#d97706' } }, text.slice(idx, idx + query.length)),
          text.slice(idx + query.length)
        );
      };

      const FOCUS_AREAS = [
        { id: 'research', icon: 'üî¨', title: 'Research & Science', desc: 'Find the latest papers, trials, and treatment approaches' },
        { id: 'experts', icon: 'ü§ù', title: 'Expert Connections', desc: 'Identify and reach out to researchers and clinicians' },
        { id: 'regulatory', icon: 'üß≠', title: 'Regulatory Path', desc: 'Map FDA pathways, orphan drug designation, and legal structure' },
        { id: 'funding', icon: 'üí∞', title: 'Funding & Community', desc: 'Find grants, build fundraising strategy, connect with other families' },
      ];

      const toggleFocus = (id) => {
        if (id === 'all') {
          const allIds = FOCUS_AREAS.map(f => f.id);
          const allSelected = allIds.every(fid => mission.priorities.includes(fid));
          if (allSelected) {
            setMission({ ...mission, priorities: [] });
          } else {
            setMission({ ...mission, priorities: [...allIds] });
          }
          return;
        }
        const newPriorities = mission.priorities.includes(id)
          ? mission.priorities.filter(p => p !== id)
          : [...mission.priorities, id];
        setMission({ ...mission, priorities: newPriorities });
      };

      const allSelected = FOCUS_AREAS.every(f => mission.priorities.includes(f.id));

      return (
        <div className="stage">
          <div className="container-centered">
            {step === 0 && (
              <>
                <div className="beacon-logo">
                  <div className="beacon-icon">üîÜ</div>
                  <div className="beacon-title">Beacon</div>
                </div>
                <h1>You've just received a diagnosis that changed everything.</h1>
                <p style={{ fontSize: '1.25rem', maxWidth: '600px' }}>
                  We're here to help. Beacon is a team of AI agents that works around the clock to
                  find treatments, connect with researchers, navigate regulatory pathways, and raise funds.
                </p>
                <form onSubmit={handleDiseaseSubmit} style={{ width: '100%', maxWidth: '500px', marginTop: '2rem', position: 'relative' }}>
                  <div className="typeahead-wrapper">
                    <div className="typeahead-input-wrapper">
                      <span className="typeahead-icon">üîç</span>
                      <input
                        type="text"
                        className="input-field typeahead-input"
                        placeholder="Search for a rare disease..."
                        value={searchQuery}
                        onChange={handleSearchChange}
                        onFocus={() => { if (filteredDiseases.length > 0) setShowDropdown(true); }}
                        onBlur={() => setTimeout(() => setShowDropdown(false), 200)}
                        autoFocus
                      />
                    </div>
                    {showDropdown && filteredDiseases.length > 0 && (
                      <div className="typeahead-dropdown">
                        {filteredDiseases.map((d, i) => (
                          <div key={i} className="typeahead-option" onMouseDown={() => selectDisease(d)}>
                            <div className="typeahead-option-name">{highlightMatch(d.name, searchQuery)}</div>
                            <div className="typeahead-option-aliases">{d.aliases.join(' ¬∑ ')}</div>
                          </div>
                        ))}
                      </div>
                    )}
                  </div>
                  <p style={{ fontSize: '0.9rem', color: '#9ca3af', marginTop: '0.5rem', marginBottom: '1.5rem' }}>
                    Don't see your disease? Type it in and press Continue.
                  </p>
                  <button type="submit" className="btn btn-primary" style={{ width: '100%' }} disabled={!mission.disease.trim()}>
                    Continue
                  </button>
                </form>
              </>
            )}

            {step === 1 && (
              <div className="intake-question">
                <label className="question-label">What should your team focus on?</label>
                <p style={{ color: '#6b7280', marginBottom: '2rem', fontSize: '1.05rem' }}>
                  Select one or more areas. You can change these anytime.
                </p>

                <div className="focus-grid">
                  {FOCUS_AREAS.map(area => (
                    <div
                      key={area.id}
                      className={`focus-card ${mission.priorities.includes(area.id) ? 'selected' : ''}`}
                      onClick={() => toggleFocus(area.id)}
                    >
                      <div className="focus-card-icon">{area.icon}</div>
                      <div className="focus-card-title">{area.title}</div>
                      <div className="focus-card-desc">{area.desc}</div>
                    </div>
                  ))}
                </div>

                <div
                  className={`focus-card focus-card-all ${allSelected ? 'selected' : ''}`}
                  onClick={() => toggleFocus('all')}
                >
                  <div className="focus-card-icon">üöÄ</div>
                  <div className="focus-card-title">All of the Above</div>
                  <div className="focus-card-desc">Give me the full team ‚Äî recommended for most families</div>
                </div>

                <button
                  className="btn btn-primary"
                  style={{ marginTop: '2rem', width: '100%', maxWidth: '400px', fontSize: '1.15rem', padding: '1.1rem 2rem' }}
                  onClick={() => { if (mission.priorities.length > 0) navigateTo('team'); }}
                  disabled={mission.priorities.length === 0}
                >
                  Assemble my team ‚Üí
                </button>
              </div>
            )}
          </div>
        </div>
      );
    }

    // Stage 2: Team
    function TeamStage({ navigateTo }) {
      return (
        <div className="stage">
          <div className="container">
            <div className="text-center mb-3">
              <h1>We're assembling your team.</h1>
              <p style={{ fontSize: '1.25rem', color: '#6b7280' }}>
                Five AI agents, each an expert in their domain, working together on your mission.
              </p>
            </div>

            <div className="agent-grid">
              <div className="agent-card scout">
                <div className="agent-icon">üî¨</div>
                <div className="agent-name">Scout</div>
                <div className="agent-role">Your Research Scientist</div>
                <div className="agent-description">
                  Searches the global literature, finds the latest discoveries, and identifies promising treatment approaches.
                </div>
              </div>

              <div className="agent-card connector">
                <div className="agent-icon">ü§ù</div>
                <div className="agent-name">Connector</div>
                <div className="agent-role">Your Medical Liaison</div>
                <div className="agent-description">
                  Finds and reaches out to the world's leading researchers and clinicians working on this disease.
                </div>
              </div>

              <div className="agent-card navigator">
                <div className="agent-icon">üß≠</div>
                <div className="agent-name">Navigator</div>
                <div className="agent-role">Your Regulatory Strategist</div>
                <div className="agent-description">
                  Maps the path from where you are now to a clinical trial. Knows FDA pathways and orphan drug programs.
                </div>
              </div>

              <div className="agent-card mobilizer">
                <div className="agent-icon">üí∞</div>
                <div className="agent-name">Mobilizer</div>
                <div className="agent-role">Your Fundraising Coordinator</div>
                <div className="agent-description">
                  Finds grants, builds fundraising strategy, and connects you with the rare disease community.
                </div>
              </div>

              <div className="agent-card strategist">
                <div className="agent-icon">üéØ</div>
                <div className="agent-name">Strategist</div>
                <div className="agent-role">Your Chief of Staff</div>
                <div className="agent-description">
                  Coordinates the whole team. Makes sure you see the right information at the right time.
                </div>
              </div>
            </div>

            <div className="text-center mt-3">
              <button className="btn btn-primary" onClick={() => navigateTo('launch')} style={{ fontSize: '1.25rem', padding: '1.25rem 3rem' }}>
                Start the mission ‚Üí
              </button>
            </div>
          </div>
        </div>
      );
    }

    // Demo mode simulation data
    const DEMO_SCRIPT = [
      // [delayMs, agentId, status, current_task, updates]
      { t: 0, agents: {
        scout: { status: 'idle', current_task: '', updates: [] },
        connector: { status: 'idle', current_task: '', updates: [] },
        navigator: { status: 'idle', current_task: '', updates: [] },
        mobilizer: { status: 'idle', current_task: '', updates: [] },
        strategist: { status: 'idle', current_task: '', updates: [] },
      }},
      { t: 1500, agents: {
        scout: { status: 'working', current_task: 'Searching bioRxiv & PubMed...', updates: [
          { message: 'Querying PubMed for CLN3 Batten Disease...', completed: false }
        ]},
        connector: { status: 'idle', current_task: '', updates: [] },
        navigator: { status: 'idle', current_task: '', updates: [] },
        mobilizer: { status: 'idle', current_task: '', updates: [] },
        strategist: { status: 'idle', current_task: '', updates: [] },
      }},
      { t: 4000, agents: {
        scout: { status: 'working', current_task: 'Analyzing gene therapy literature...', updates: [
          { message: 'Querying PubMed for CLN3 Batten Disease...', completed: true },
          { message: 'Found 847 publications spanning 1995-2025', completed: true },
          { message: 'Analyzing AAV9-based gene therapy approaches...', completed: false },
        ]},
        connector: { status: 'working', current_task: 'Identifying key researchers...', updates: [
          { message: 'Scanning ClinicalTrials.gov for CLN3 investigators...', completed: false },
        ]},
        navigator: { status: 'working', current_task: 'Mapping FDA orphan drug pathways...', updates: [
          { message: 'Checking FDA Orphan Drug Database...', completed: false },
        ]},
        mobilizer: { status: 'idle', current_task: '', updates: [] },
        strategist: { status: 'idle', current_task: '', updates: [] },
      }},
      { t: 8000, agents: {
        scout: { status: 'complete', current_task: 'Research complete', updates: [
          { message: 'Querying PubMed for CLN3 Batten Disease...', completed: true },
          { message: 'Found 847 publications spanning 1995-2025', completed: true },
          { message: 'Analyzing AAV9-based gene therapy approaches...', completed: true },
          { message: 'Identified 3 promising therapeutic strategies', type: 'finding', completed: true },
          { message: 'Gene therapy (AAV9-CLN3) ‚Äî Phase I/II trial active', type: 'finding', completed: true },
        ]},
        connector: { status: 'working', current_task: 'Drafting outreach emails...', updates: [
          { message: 'Scanning ClinicalTrials.gov for CLN3 investigators...', completed: true },
          { message: 'Identified Dr. Jonathan Cooper ‚Äî Weill Cornell', type: 'finding', completed: true },
          { message: 'Drafting personalized outreach to 5 researchers...', completed: false },
        ]},
        navigator: { status: 'working', current_task: 'Analyzing expedited pathways...', updates: [
          { message: 'Checking FDA Orphan Drug Database...', completed: true },
          { message: 'CLN3 has Orphan Drug Designation ‚Äî eligible for incentives', type: 'finding', completed: true },
          { message: 'Evaluating Accelerated Approval pathway...', completed: false },
        ]},
        mobilizer: { status: 'working', current_task: 'Finding grant opportunities...', updates: [
          { message: 'Searching NIH Reporter for NCL funding...', completed: false },
        ]},
        strategist: { status: 'idle', current_task: '', updates: [] },
      }},
      { t: 14000, agents: {
        scout: { status: 'complete', current_task: 'Research complete', updates: [
          { message: 'Querying PubMed for CLN3 Batten Disease...', completed: true },
          { message: 'Found 847 publications spanning 1995-2025', completed: true },
          { message: 'Analyzing AAV9-based gene therapy approaches...', completed: true },
          { message: 'Identified 3 promising therapeutic strategies', type: 'finding', completed: true },
          { message: 'Gene therapy (AAV9-CLN3) ‚Äî Phase I/II trial active', type: 'finding', completed: true },
        ]},
        connector: { status: 'complete', current_task: 'Outreach ready', updates: [
          { message: 'Scanning ClinicalTrials.gov for CLN3 investigators...', completed: true },
          { message: 'Identified Dr. Jonathan Cooper ‚Äî Weill Cornell', type: 'finding', completed: true },
          { message: 'Drafting personalized outreach to 5 researchers...', completed: true },
          { message: '5 outreach emails ready for your review', type: 'finding', completed: true },
        ]},
        navigator: { status: 'complete', current_task: 'Pathway mapped', updates: [
          { message: 'Checking FDA Orphan Drug Database...', completed: true },
          { message: 'CLN3 has Orphan Drug Designation ‚Äî eligible for incentives', type: 'finding', completed: true },
          { message: 'Evaluating Accelerated Approval pathway...', completed: true },
          { message: 'Recommended: Rare Pediatric Disease Priority Review Voucher', type: 'finding', completed: true },
        ]},
        mobilizer: { status: 'complete', current_task: 'Strategy ready', updates: [
          { message: 'Searching NIH Reporter for NCL funding...', completed: true },
          { message: 'Found $4.2M in active NIH grants for CLN3 research', type: 'finding', completed: true },
          { message: 'Identified CZI Rare As One Network ‚Äî deadline March 15', type: 'finding', completed: true },
        ]},
        strategist: { status: 'working', current_task: 'Synthesizing roadmap...', updates: [
          { message: 'Integrating findings from all agents...', completed: false },
        ]},
      }},
      { t: 20000, agents: {
        scout: { status: 'complete', current_task: 'Research complete', updates: [
          { message: 'Querying PubMed for CLN3 Batten Disease...', completed: true },
          { message: 'Found 847 publications spanning 1995-2025', completed: true },
          { message: 'Analyzing AAV9-based gene therapy approaches...', completed: true },
          { message: 'Identified 3 promising therapeutic strategies', type: 'finding', completed: true },
          { message: 'Gene therapy (AAV9-CLN3) ‚Äî Phase I/II trial active', type: 'finding', completed: true },
        ]},
        connector: { status: 'complete', current_task: 'Outreach ready', updates: [
          { message: 'Scanning ClinicalTrials.gov for CLN3 investigators...', completed: true },
          { message: 'Identified Dr. Jonathan Cooper ‚Äî Weill Cornell', type: 'finding', completed: true },
          { message: 'Drafting personalized outreach to 5 researchers...', completed: true },
          { message: '5 outreach emails ready for your review', type: 'finding', completed: true },
        ]},
        navigator: { status: 'complete', current_task: 'Pathway mapped', updates: [
          { message: 'Checking FDA Orphan Drug Database...', completed: true },
          { message: 'CLN3 has Orphan Drug Designation ‚Äî eligible for incentives', type: 'finding', completed: true },
          { message: 'Evaluating Accelerated Approval pathway...', completed: true },
          { message: 'Recommended: Rare Pediatric Disease Priority Review Voucher', type: 'finding', completed: true },
        ]},
        mobilizer: { status: 'complete', current_task: 'Strategy ready', updates: [
          { message: 'Searching NIH Reporter for NCL funding...', completed: true },
          { message: 'Found $4.2M in active NIH grants for CLN3 research', type: 'finding', completed: true },
          { message: 'Identified CZI Rare As One Network ‚Äî deadline March 15', type: 'finding', completed: true },
        ]},
        strategist: { status: 'complete', current_task: 'Roadmap ready', updates: [
          { message: 'Integrating findings from all agents...', completed: true },
          { message: 'Roadmap generated with 4 phases and 12 milestones', type: 'finding', completed: true },
        ]},
      }},
    ];

    function isDemo() {
      return new URLSearchParams(window.location.search).has('demo');
    }

    // Stage 3: Launch
    function LaunchStage({ state, navigateTo }) {
      const agents = [
        { id: 'scout', icon: 'üî¨', name: 'Scout', color: '#8b5cf6' },
        { id: 'connector', icon: 'ü§ù', name: 'Connector', color: '#ec4899' },
        { id: 'navigator', icon: 'üß≠', name: 'Navigator', color: '#3b82f6' },
        { id: 'mobilizer', icon: 'üí∞', name: 'Mobilizer', color: '#10b981' },
        { id: 'strategist', icon: 'üéØ', name: 'Strategist', color: '#f59e0b' }
      ];

      const [email, setEmail] = useState('');
      const [emailSubmitted, setEmailSubmitted] = useState(false);
      const [expandedAgent, setExpandedAgent] = useState(null);
      const [countdown, setCountdown] = useState(null);
      const [cancelledAutoAdvance, setCancelledAutoAdvance] = useState(false);
      const [demoState, setDemoState] = useState(null);

      const demo = isDemo();

      // Demo mode: run scripted simulation
      useEffect(() => {
        if (!demo) return;
        const timers = DEMO_SCRIPT.map(frame =>
          setTimeout(() => {
            setDemoState({ agents: frame.agents, mission: { disease: 'CLN3 Batten Disease' } });
          }, frame.t)
        );
        return () => timers.forEach(clearTimeout);
      }, [demo]);

      const effectiveState = demo ? demoState : state;

      const agentStates = agents.map(a => ({
        ...a,
        status: effectiveState?.agents?.[a.id]?.status || 'idle',
        current_task: effectiveState?.agents?.[a.id]?.current_task || '',
        updates: effectiveState?.agents?.[a.id]?.updates || [],
      }));

      const completeCount = agentStates.filter(a => a.status === 'complete').length;
      const allComplete = completeCount === 5;

      // Auto-advance countdown
      useEffect(() => {
        if (allComplete && !cancelledAutoAdvance) {
          setCountdown(3);
        }
      }, [allComplete]);

      useEffect(() => {
        if (countdown === null || countdown <= 0) return;
        const timer = setTimeout(() => setCountdown(countdown - 1), 1000);
        return () => clearTimeout(timer);
      }, [countdown]);

      useEffect(() => {
        if (countdown === 0 && !cancelledAutoAdvance) {
          navigateTo('roadmap');
        }
      }, [countdown, cancelledAutoAdvance]);

      const handleEmailSubmit = (e) => {
        e.preventDefault();
        if (email.trim()) {
          localStorage.setItem('beacon_notify_email', email);
          setEmailSubmitted(true);
        }
      };

      const toggleAgent = (id) => {
        setExpandedAgent(expandedAgent === id ? null : id);
      };

      return (
        <div className="stage">
          <div className="container" style={{ maxWidth: '800px', margin: '0 auto' }}>
            <div className="text-center mb-3">
              <h1>üîÜ Beacon ‚Äî Mission Active</h1>
              <p style={{ fontSize: '1.25rem', color: '#6b7280' }}>
                {effectiveState?.mission?.disease || 'Your team is working'}
              </p>
            </div>

            {/* Countdown banner */}
            {allComplete && !cancelledAutoAdvance && countdown !== null && (
              <div className="countdown-banner">
                <span>Your roadmap is ready! Redirecting in {countdown}...</span>
                <button onClick={() => navigateTo('roadmap')}>Go now ‚Üí</button>
                <button onClick={() => { setCancelledAutoAdvance(true); setCountdown(null); }}>Stay here</button>
              </div>
            )}

            {/* Email notification opt-in */}
            {!allComplete && (
              <div className="launch-notify">
                <h2>Your team is on it.</h2>
                {!emailSubmitted ? (
                  <>
                    <p>This usually takes about 10 minutes. We'll email you when your roadmap is ready.</p>
                    <form className="launch-notify-form" onSubmit={handleEmailSubmit}>
                      <input
                        type="email"
                        placeholder="your@email.com"
                        value={email}
                        onChange={(e) => setEmail(e.target.value)}
                      />
                      <button type="submit" className="btn btn-primary btn-small">Notify me</button>
                    </form>
                  </>
                ) : (
                  <p className="launch-notify-success">‚úì We'll let you know! Feel free to close this tab.</p>
                )}
              </div>
            )}

            {/* Overall progress bar */}
            <div className="launch-progress-bar">
              <div className="progress-text">{completeCount} of 5 agents complete</div>
              <div className="launch-progress-track">
                <div className="launch-progress-fill" style={{ width: `${(completeCount / 5) * 100}%` }}></div>
              </div>
            </div>

            {/* Agent circles */}
            <div className="agent-circles">
              {agentStates.map(a => (
                <div
                  key={a.id}
                  className={`agent-circle ${expandedAgent === a.id ? 'expanded' : ''}`}
                  onClick={() => toggleAgent(a.id)}
                  title={a.name}
                >
                  {a.icon}
                  <div className={`agent-circle-dot ${a.status}`}></div>
                  <div className="agent-circle-name">{a.name}</div>
                </div>
              ))}
            </div>

            {/* Expanded agent detail panel (accordion) */}
            {expandedAgent && (() => {
              const a = agentStates.find(ag => ag.id === expandedAgent);
              if (!a) return null;
              return (
                <div className="agent-detail-panel">
                  <div className="status-header">
                    <div className="status-icon">{a.icon}</div>
                    <div className="status-info">
                      <h3>{a.name}</h3>
                      <div className={`status-label ${a.status === 'working' ? 'working' : ''}`}>
                        {a.status === 'working' ? a.current_task : a.status === 'complete' ? 'Complete' : 'Initializing'}
                      </div>
                    </div>
                  </div>
                  <ul className="status-updates">
                    {a.updates.map((update, i) => (
                      <li
                        key={i}
                        className={`status-update ${update.completed ? 'completed' : ''} ${update.type === 'finding' ? 'finding' : ''}`}
                        style={{ animationDelay: `${i * 0.1}s` }}
                      >
                        {i === a.updates.length - 1 ? '‚îî‚îÄ ' : '‚îú‚îÄ '}
                        {update.completed && '‚úì '}
                        {update.message}
                      </li>
                    ))}
                    {a.updates.length === 0 && (
                      <li className="status-update" style={{ color: '#9ca3af' }}>Waiting to start...</li>
                    )}
                  </ul>
                </div>
              );
            })()}

            {/* Manual advance button if auto-advance cancelled */}
            {allComplete && cancelledAutoAdvance && (
              <div className="text-center mt-3">
                <button
                  className="btn btn-primary"
                  onClick={() => navigateTo('roadmap')}
                  style={{ fontSize: '1.25rem', padding: '1.25rem 3rem' }}
                >
                  View your roadmap ‚Üí
                </button>
              </div>
            )}
          </div>
        </div>
      );
    }

    // Stage 4: Roadmap
    function RoadmapStage({ mission, navigateTo }) {
      return (
        <div className="stage">
          <div className="container">
            <div className="text-center mb-3">
              <h1>Your Roadmap</h1>
              <p style={{ fontSize: '1.25rem', color: '#6b7280' }}>
                {mission.disease}
              </p>
            </div>

            <div className="timeline">
              <div className="timeline-phase active">
                <div className="timeline-marker">1</div>
                <div className="timeline-label">NOW</div>
                <div className="timeline-title">Research & Outreach</div>
                <ul className="timeline-milestones">
                  <li>Map disease landscape</li>
                  <li>Identify key researchers</li>
                  <li>Initial outreach</li>
                </ul>
              </div>

              <div className="timeline-phase">
                <div className="timeline-marker">2</div>
                <div className="timeline-label">3 MONTHS</div>
                <div className="timeline-title">Preclinical Planning</div>
                <ul className="timeline-milestones">
                  <li>Target validation</li>
                  <li>Model selection</li>
                  <li>Grant applications</li>
                </ul>
              </div>

              <div className="timeline-phase">
                <div className="timeline-marker">3</div>
                <div className="timeline-label">12 MONTHS</div>
                <div className="timeline-title">IND Filing</div>
                <ul className="timeline-milestones">
                  <li>Orphan drug designation</li>
                  <li>Manufacturing plan</li>
                  <li>FDA pre-IND meeting</li>
                </ul>
              </div>

              <div className="timeline-phase">
                <div className="timeline-marker">4</div>
                <div className="timeline-label">24 MONTHS</div>
                <div className="timeline-title">Clinical Trial</div>
                <ul className="timeline-milestones">
                  <li>Site selection</li>
                  <li>Patient enrollment</li>
                  <li>Trial initiation</li>
                </ul>
              </div>
            </div>

            <div className="priorities-section">
              <h2>This Week's Priorities</h2>
              <ul className="priority-list">
                <li className="priority-item">
                  Review outreach emails to top 5 researchers and approve for sending
                </li>
                <li className="priority-item">
                  Evaluate dual-track strategy: gene therapy vs. small molecule approach
                </li>
                <li className="priority-item">
                  Review and submit Letter of Intent for CZI Rare As One Network grant
                </li>
              </ul>
            </div>

            <div className="text-center mt-3">
              <button
                className="btn btn-primary"
                onClick={() => navigateTo('mission')}
                style={{ fontSize: '1.25rem', padding: '1.25rem 3rem' }}
              >
                Go to Mission Control ‚Üí
              </button>
            </div>
          </div>
        </div>
      );
    }

    // Stage 5: Mission Control
    function MissionControlStage({
      mission,
      state,
      scoutReport,
      connectorReport,
      navigatorReport,
      mobilizerReport,
      strategistBriefing,
      setModalOpen,
      setSelectedApproval
    }) {
      const approvals = state?.approvals || [];
      const newCount = approvals.filter(a => !a.reviewed).length;

      const allFindings = [];

      if (scoutReport?.findings) {
        scoutReport.findings.forEach(f => {
          allFindings.push({
            agent: 'Scout',
            icon: 'üî¨',
            time: '2 hours ago',
            ...f
          });
        });
      }

      if (connectorReport?.contacts) {
        connectorReport.contacts.slice(0, 2).forEach(c => {
          allFindings.push({
            agent: 'Connector',
            icon: 'ü§ù',
            time: '3 hours ago',
            title: `Identified: ${c.name}`,
            summary: c.institution,
            significance: 'High Priority'
          });
        });
      }

      const AGENT_META = [
        { id: 'scout', name: 'Scout', icon: 'üî¨' },
        { id: 'connector', name: 'Connector', icon: 'ü§ù' },
        { id: 'navigator', name: 'Navigator', icon: 'üß≠' },
        { id: 'mobilizer', name: 'Mobilizer', icon: 'üí∞' },
        { id: 'strategist', name: 'Strategist', icon: 'üéØ' }
      ];
      const agents = AGENT_META.map(meta => ({
        ...meta,
        status: state?.agents?.[meta.id]?.status || 'idle',
        current_task: state?.agents?.[meta.id]?.current_task || ''
      }));

      const handleReview = (approval) => {
        setSelectedApproval(approval);
        setModalOpen(true);
      };

      return (
        <>
          <div className="header-bar">
            <div className="header-title">
              <span className="header-icon">üîÜ</span>
              <span>Beacon ‚Äî {mission.disease || 'Mission Control'}</span>
            </div>
            {newCount > 0 && (
              <div className="notification-badge">
                üîî {newCount} new
              </div>
            )}
          </div>

          <div className="mission-control">
            {approvals.length > 0 && (
              <div className="attention-section">
                <h2>Needs Your Attention</h2>
                <div className="approval-cards">
                  {approvals.map((approval, i) => (
                    <div key={i} className="approval-card">
                      <div className="approval-info">
                        <div className="approval-badge">{approval.type}</div>
                        <div className="approval-title">{approval.title}</div>
                        <div className="approval-summary">{approval.summary}</div>
                      </div>
                      <button className="btn btn-primary btn-small" onClick={() => handleReview(approval)}>
                        Review ‚Üí
                      </button>
                    </div>
                  ))}
                </div>
              </div>
            )}

            <div className="main-grid">
              <div className="feed-section">
                <h2>Recent Discoveries</h2>
                <div className="feed-items">
                  {allFindings.length > 0 ? (
                    allFindings.map((finding, i) => (
                      <div key={i} className="feed-item" style={{ animationDelay: `${i * 0.1}s` }}>
                        <div className="feed-header">
                          <span>{finding.icon}</span>
                          <span className="feed-agent">{finding.agent}</span>
                          <span className="feed-time">{finding.time}</span>
                        </div>
                        <div className="feed-title">{finding.title}</div>
                        <div className="feed-summary">{finding.summary}</div>
                        {finding.significance && (
                          <div className="significance-badge">{finding.significance}</div>
                        )}
                      </div>
                    ))
                  ) : (
                    <div className="feed-item">
                      <div className="feed-header">
                        <span>üî¨</span>
                        <span className="feed-agent">Scout</span>
                        <span className="feed-time">1 hour ago</span>
                      </div>
                      <div className="feed-title">TRPML1 Channel Activation Shows Promise</div>
                      <div className="feed-summary">
                        New paper demonstrates lysosomal calcium channel activation as potential therapeutic target for CLN3 disease.
                      </div>
                      <div className="significance-badge">High Impact</div>
                    </div>
                  )}
                </div>
              </div>

              <div className="agent-status-section">
                <h2>Agent Status</h2>
                <div className="agent-status-list">
                  {agents.map((agent) => (
                    <div key={agent.id} className="agent-status-row">
                      <div className={`status-dot ${agent.status}`}></div>
                      <div className="agent-status-info">
                        <div className="agent-status-name">
                          {agent.icon} {agent.name}
                        </div>
                        <div className="agent-status-task">{agent.current_task}</div>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            </div>

            <div className="progress-section">
              <h2>Roadmap Progress</h2>
              <div className="progress-bars">
                <div className="progress-bar-item">
                  <div className="progress-label">
                    <span>Research & Literature Mapping</span>
                    <span>73%</span>
                  </div>
                  <div className="progress-bar-bg">
                    <div className="progress-bar-fill" style={{ width: '73%' }}></div>
                  </div>
                </div>
                <div className="progress-bar-item">
                  <div className="progress-label">
                    <span>Researcher Outreach</span>
                    <span>45%</span>
                  </div>
                  <div className="progress-bar-bg">
                    <div className="progress-bar-fill" style={{ width: '45%' }}></div>
                  </div>
                </div>
                <div className="progress-bar-item">
                  <div className="progress-label">
                    <span>Regulatory Pathway Mapping</span>
                    <span>82%</span>
                  </div>
                  <div className="progress-bar-bg">
                    <div className="progress-bar-fill" style={{ width: '82%' }}></div>
                  </div>
                </div>
              </div>
              <div style={{ textAlign: 'center', marginTop: '1.5rem' }}>
                <a href="#roadmap" style={{ color: '#d97706', fontWeight: 600, textDecoration: 'none' }}>
                  View full roadmap ‚Üí
                </a>
              </div>
            </div>
          </div>

          <div className="chat-input-section">
            <div className="chat-input-wrapper">
              <input
                type="text"
                className="chat-input"
                placeholder="Ask your team anything..."
              />
              <button className="btn btn-primary">Send</button>
            </div>
          </div>
        </>
      );
    }

    // Approval Modal
    function ApprovalModal({ approval, onClose }) {
      const [editedApproval, setEditedApproval] = useState({ ...approval });

      const handleApprove = () => {
        console.log('Approved:', editedApproval);
        alert('Email approved and queued for sending!');
        onClose();
      };

      return (
        <div className="modal-overlay" onClick={onClose}>
          <div className="modal" onClick={(e) => e.stopPropagation()}>
            <div className="modal-header">
              <h2 className="modal-title">Review & Approve</h2>
              <button className="modal-close" onClick={onClose}>√ó</button>
            </div>

            <div className="modal-field">
              <label className="modal-label">To:</label>
              <input
                type="text"
                className="modal-input"
                value={editedApproval.to || ''}
                onChange={(e) => setEditedApproval({ ...editedApproval, to: e.target.value })}
              />
            </div>

            <div className="modal-field">
              <label className="modal-label">Subject:</label>
              <input
                type="text"
                className="modal-input"
                value={editedApproval.subject || editedApproval.title}
                onChange={(e) => setEditedApproval({ ...editedApproval, subject: e.target.value })}
              />
            </div>

            <div className="modal-field">
              <label className="modal-label">Message:</label>
              <textarea
                className="modal-textarea"
                value={editedApproval.body || editedApproval.content || ''}
                onChange={(e) => setEditedApproval({ ...editedApproval, body: e.target.value })}
              />
            </div>

            {approval.note && (
              <div className="modal-note">
                <div className="modal-note-label">Connector's Note:</div>
                <div className="modal-note-text">{approval.note}</div>
              </div>
            )}

            <div className="modal-actions">
              <button className="btn btn-approve" onClick={handleApprove}>
                Approve & Send
              </button>
              <button className="btn btn-primary btn-small" onClick={() => alert('Edits saved!')}>
                Save Edits
              </button>
              <button className="btn btn-cancel btn-small" onClick={onClose}>
                Cancel
              </button>
            </div>
          </div>
        </div>
      );
    }

    // Render App
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
