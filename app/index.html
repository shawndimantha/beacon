<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Beacon - Your AI Team for Rare Disease Treatment</title>

  <!-- React 18 + ReactDOM via CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Babel Standalone for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    /* Reset & Base Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', sans-serif;
      background: #faf8f5;
      color: #1f2937;
      line-height: 1.6;
      overflow-x: hidden;
    }

    /* Typography */
    h1 {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 1rem;
      color: #111827;
    }

    h2 {
      font-size: 2rem;
      font-weight: 600;
      margin-bottom: 0.75rem;
      color: #111827;
    }

    h3 {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: #1f2937;
    }

    p {
      font-size: 1.125rem;
      color: #4b5563;
      margin-bottom: 1rem;
    }

    /* Layout Containers */
    .stage {
      min-height: 100vh;
      padding: 3rem 2rem;
      opacity: 0;
      animation: fadeIn 0.6s ease-in forwards;
    }

    @keyframes fadeIn {
      to { opacity: 1; }
    }

    .container {
      max-width: 1280px;
      margin: 0 auto;
    }

    .container-narrow {
      max-width: 720px;
      margin: 0 auto;
    }

    .container-centered {
      max-width: 720px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 80vh;
      text-align: center;
    }

    /* Beacon Logo */
    .beacon-logo {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .beacon-icon {
      width: 80px;
      height: 80px;
      background: linear-gradient(135deg, #d97706 0%, #f59e0b 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.5rem;
      box-shadow: 0 10px 30px rgba(217, 119, 6, 0.3);
    }

    .beacon-title {
      font-size: 3rem;
      font-weight: 800;
      background: linear-gradient(135deg, #d97706 0%, #f59e0b 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* Buttons */
    .btn {
      padding: 1rem 2.5rem;
      font-size: 1.125rem;
      font-weight: 600;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .btn-primary {
      background: linear-gradient(135deg, #d97706 0%, #f59e0b 100%);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(217, 119, 6, 0.4);
    }

    .btn-secondary {
      background: white;
      color: #d97706;
      border: 2px solid #d97706;
    }

    .btn-secondary:hover {
      background: #fef3c7;
    }

    .btn-small {
      padding: 0.5rem 1.5rem;
      font-size: 0.95rem;
    }

    /* Input Fields */
    .input-field {
      width: 100%;
      padding: 1rem 1.5rem;
      font-size: 1.125rem;
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      margin-bottom: 1.5rem;
      transition: border-color 0.3s ease;
      background: white;
    }

    .input-field:focus {
      outline: none;
      border-color: #d97706;
    }

    /* Button Group */
    .button-group {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 1.5rem;
    }

    .btn-option {
      padding: 0.75rem 1.5rem;
      font-size: 1rem;
      background: white;
      border: 2px solid #e5e7eb;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-option:hover {
      border-color: #d97706;
      background: #fef3c7;
    }

    .btn-option.selected {
      background: #d97706;
      color: white;
      border-color: #d97706;
    }

    /* Checkbox Group */
    .checkbox-group {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      align-items: flex-start;
      margin-bottom: 2rem;
    }

    .checkbox-label {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-size: 1.125rem;
      cursor: pointer;
      padding: 0.5rem;
    }

    .checkbox-label input {
      width: 24px;
      height: 24px;
      cursor: pointer;
    }

    /* Intake Questions */
    .intake-question {
      margin-bottom: 3rem;
      opacity: 0;
      animation: slideInUp 0.5s ease-out forwards;
    }

    @keyframes slideInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .question-label {
      font-size: 1.5rem;
      font-weight: 600;
      color: #111827;
      margin-bottom: 1.5rem;
      display: block;
    }

    /* Agent Cards */
    .agent-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 2rem;
      margin-bottom: 3rem;
    }

    .agent-card {
      background: white;
      border-radius: 16px;
      padding: 2rem;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      opacity: 0;
      animation: cardAppear 0.6s ease-out forwards;
      transition: transform 0.3s ease;
    }

    .agent-card:hover {
      transform: translateY(-4px);
    }

    .agent-card:nth-child(1) { animation-delay: 0s; }
    .agent-card:nth-child(2) { animation-delay: 0.3s; }
    .agent-card:nth-child(3) { animation-delay: 0.6s; }
    .agent-card:nth-child(4) { animation-delay: 0.9s; }
    .agent-card:nth-child(5) { animation-delay: 1.2s; }

    @keyframes cardAppear {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .agent-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
    }

    .agent-name {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      color: #111827;
    }

    .agent-role {
      font-size: 1rem;
      font-weight: 600;
      color: #6b7280;
      margin-bottom: 1rem;
    }

    .agent-description {
      font-size: 1rem;
      color: #4b5563;
      line-height: 1.5;
    }

    /* Agent Colors */
    .agent-card.scout { border-top: 4px solid #8b5cf6; }
    .agent-card.connector { border-top: 4px solid #ec4899; }
    .agent-card.navigator { border-top: 4px solid #3b82f6; }
    .agent-card.mobilizer { border-top: 4px solid #10b981; }
    .agent-card.strategist { border-top: 4px solid #f59e0b; }

    /* Launch Status Panels */
    .status-grid {
      display: grid;
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .status-panel {
      background: white;
      border-radius: 16px;
      padding: 2rem;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
    }

    .status-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .status-icon {
      font-size: 2rem;
    }

    .status-info h3 {
      font-size: 1.25rem;
      margin-bottom: 0.25rem;
    }

    .status-label {
      font-size: 0.95rem;
      color: #6b7280;
      font-weight: 500;
    }

    .status-label.working {
      color: #d97706;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .status-updates {
      list-style: none;
      font-family: 'SF Mono', 'Monaco', 'Courier New', monospace;
      font-size: 0.95rem;
    }

    .status-update {
      padding: 0.5rem 0;
      color: #4b5563;
      opacity: 0;
      animation: fadeSlideIn 0.4s ease-out forwards;
    }

    @keyframes fadeSlideIn {
      from {
        opacity: 0;
        transform: translateX(-10px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .status-update.completed {
      color: #10b981;
    }

    .status-update.finding {
      color: #d97706;
      font-weight: 600;
    }

    /* Header Bar */
    .header-bar {
      background: white;
      border-bottom: 2px solid #f3f4f6;
      padding: 1.5rem 2rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
    }

    .header-title {
      display: flex;
      align-items: center;
      gap: 1rem;
      font-size: 1.5rem;
      font-weight: 700;
    }

    .header-icon {
      font-size: 1.75rem;
    }

    .notification-badge {
      background: #d97706;
      color: white;
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: 600;
    }

    /* Timeline */
    .timeline {
      display: flex;
      justify-content: space-between;
      margin: 3rem 0;
      position: relative;
      padding: 2rem 0;
    }

    .timeline::before {
      content: '';
      position: absolute;
      top: 2.5rem;
      left: 0;
      right: 0;
      height: 4px;
      background: #e5e7eb;
      z-index: 0;
    }

    .timeline-phase {
      flex: 1;
      position: relative;
      z-index: 1;
    }

    .timeline-marker {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: white;
      border: 4px solid #e5e7eb;
      margin: 0 auto 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
    }

    .timeline-phase.active .timeline-marker {
      background: #d97706;
      border-color: #d97706;
      color: white;
    }

    .timeline-label {
      font-weight: 600;
      font-size: 0.95rem;
      text-align: center;
      color: #6b7280;
      margin-bottom: 0.5rem;
    }

    .timeline-phase.active .timeline-label {
      color: #d97706;
    }

    .timeline-title {
      font-weight: 700;
      font-size: 1.1rem;
      text-align: center;
      margin-bottom: 1rem;
    }

    .timeline-milestones {
      list-style: none;
      font-size: 0.9rem;
      color: #6b7280;
      text-align: center;
    }

    .timeline-milestones li {
      margin-bottom: 0.5rem;
    }

    /* Priorities Section */
    .priorities-section {
      background: white;
      border-radius: 16px;
      padding: 2rem;
      margin: 3rem 0;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    }

    .priority-list {
      list-style: none;
      counter-reset: priority-counter;
    }

    .priority-item {
      counter-increment: priority-counter;
      position: relative;
      padding-left: 3rem;
      margin-bottom: 1.5rem;
      font-size: 1.1rem;
    }

    .priority-item::before {
      content: counter(priority-counter);
      position: absolute;
      left: 0;
      top: 0;
      width: 2rem;
      height: 2rem;
      background: #d97706;
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
    }

    /* Mission Control Layout */
    .mission-control {
      padding: 2rem;
    }

    .attention-section {
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
      border-radius: 16px;
      padding: 2rem;
      margin-bottom: 2rem;
      border-left: 6px solid #d97706;
    }

    .approval-cards {
      display: grid;
      gap: 1rem;
      margin-top: 1.5rem;
    }

    .approval-card {
      background: white;
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .approval-info {
      flex: 1;
    }

    .approval-badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: 6px;
      font-size: 0.85rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      background: #dbeafe;
      color: #1e40af;
    }

    .approval-title {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .approval-summary {
      font-size: 0.95rem;
      color: #6b7280;
    }

    .main-grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 2rem;
      margin-bottom: 2rem;
    }

    .feed-section {
      background: white;
      border-radius: 16px;
      padding: 2rem;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
    }

    .feed-items {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      margin-top: 1.5rem;
    }

    .feed-item {
      padding: 1.5rem;
      border-radius: 12px;
      background: #fafafa;
      border-left: 4px solid #d97706;
      opacity: 0;
      animation: fadeSlideIn 0.5s ease-out forwards;
    }

    .feed-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }

    .feed-agent {
      font-weight: 600;
      font-size: 0.95rem;
    }

    .feed-time {
      color: #9ca3af;
      font-size: 0.85rem;
    }

    .feed-title {
      font-weight: 600;
      font-size: 1.1rem;
      margin-bottom: 0.5rem;
    }

    .feed-summary {
      font-size: 0.95rem;
      color: #4b5563;
      margin-bottom: 0.75rem;
    }

    .significance-badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: 6px;
      font-size: 0.85rem;
      font-weight: 600;
      background: #dcfce7;
      color: #166534;
    }

    .agent-status-section {
      background: white;
      border-radius: 16px;
      padding: 2rem;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
      height: fit-content;
    }

    .agent-status-list {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-top: 1.5rem;
    }

    .agent-status-row {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .status-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .status-dot.complete { background: #10b981; }
    .status-dot.working { background: #f59e0b; animation: pulse 2s ease-in-out infinite; }
    .status-dot.idle { background: #9ca3af; }

    .agent-status-info {
      flex: 1;
    }

    .agent-status-name {
      font-weight: 600;
      font-size: 0.95rem;
      margin-bottom: 0.25rem;
    }

    .agent-status-task {
      font-size: 0.85rem;
      color: #6b7280;
    }

    .progress-section {
      background: white;
      border-radius: 16px;
      padding: 2rem;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
    }

    .progress-bars {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      margin-top: 1.5rem;
    }

    .progress-bar-item {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .progress-label {
      display: flex;
      justify-content: space-between;
      font-size: 0.95rem;
      font-weight: 600;
    }

    .progress-bar-bg {
      height: 12px;
      background: #f3f4f6;
      border-radius: 6px;
      overflow: hidden;
    }

    .progress-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, #d97706 0%, #f59e0b 100%);
      border-radius: 6px;
      transition: width 0.5s ease;
    }

    .chat-input-section {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      border-top: 2px solid #f3f4f6;
      padding: 1.5rem 2rem;
      box-shadow: 0 -2px 12px rgba(0, 0, 0, 0.06);
    }

    .chat-input-wrapper {
      max-width: 1280px;
      margin: 0 auto;
      display: flex;
      gap: 1rem;
    }

    .chat-input {
      flex: 1;
      padding: 1rem 1.5rem;
      font-size: 1rem;
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      background: #fafafa;
    }

    .chat-input:focus {
      outline: none;
      border-color: #d97706;
      background: white;
    }

    /* Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      animation: fadeIn 0.3s ease-out forwards;
    }

    .modal {
      background: white;
      border-radius: 20px;
      padding: 2.5rem;
      max-width: 700px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      transform: scale(0.9);
      animation: modalAppear 0.3s ease-out forwards;
    }

    @keyframes modalAppear {
      to {
        transform: scale(1);
      }
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }

    .modal-title {
      font-size: 1.75rem;
      font-weight: 700;
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #9ca3af;
      transition: color 0.2s;
    }

    .modal-close:hover {
      color: #1f2937;
    }

    .modal-field {
      margin-bottom: 1.5rem;
    }

    .modal-label {
      display: block;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: #374151;
    }

    .modal-input {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      font-size: 1rem;
    }

    .modal-textarea {
      width: 100%;
      padding: 1rem;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      font-size: 1rem;
      min-height: 200px;
      font-family: inherit;
      resize: vertical;
    }

    .modal-input:focus,
    .modal-textarea:focus {
      outline: none;
      border-color: #d97706;
    }

    .modal-note {
      background: #fef3c7;
      padding: 1rem;
      border-radius: 8px;
      border-left: 4px solid #d97706;
      margin-bottom: 1.5rem;
    }

    .modal-note-label {
      font-weight: 600;
      font-size: 0.9rem;
      color: #92400e;
      margin-bottom: 0.5rem;
    }

    .modal-note-text {
      font-size: 0.95rem;
      color: #78350f;
    }

    .modal-actions {
      display: flex;
      gap: 1rem;
      margin-top: 2rem;
    }

    .btn-approve {
      background: #10b981;
      color: white;
    }

    .btn-approve:hover {
      background: #059669;
    }

    .btn-cancel {
      background: #e5e7eb;
      color: #374151;
    }

    .btn-cancel:hover {
      background: #d1d5db;
    }

    /* Utility Classes */
    .text-center {
      text-align: center;
    }

    .mt-2 { margin-top: 2rem; }
    .mt-3 { margin-top: 3rem; }
    .mb-2 { margin-bottom: 2rem; }
    .mb-3 { margin-bottom: 3rem; }

    /* Loading Animation */
    .loading-spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useCallback } = React;

    // Main App Component
    function App() {
      const [stage, setStage] = useState('welcome');
      const [mission, setMission] = useState({
        disease: '',
        patientRelation: '',
        patientName: '',
        patientAge: '',
        diagnosisDate: '',
        priorities: []
      });
      const [state, setState] = useState(null);
      const [scoutReport, setScoutReport] = useState(null);
      const [connectorReport, setConnectorReport] = useState(null);
      const [navigatorReport, setNavigatorReport] = useState(null);
      const [mobilizerReport, setMobilizerReport] = useState(null);
      const [strategistBriefing, setStrategistBriefing] = useState(null);
      const [modalOpen, setModalOpen] = useState(false);
      const [selectedApproval, setSelectedApproval] = useState(null);

      // Hash-based routing
      useEffect(() => {
        const handleHashChange = () => {
          const hash = window.location.hash.slice(1) || 'welcome';
          setStage(hash);
        };

        window.addEventListener('hashchange', handleHashChange);
        handleHashChange();

        return () => window.removeEventListener('hashchange', handleHashChange);
      }, []);

      // Data polling for mission control
      useEffect(() => {
        if (stage === 'launch' || stage === 'mission') {
          const pollData = async () => {
            try {
              const stateRes = await fetch('data/state.json');
              if (stateRes.ok) setState(await stateRes.json());
            } catch (e) {}

            try {
              const scoutRes = await fetch('data/scout-report.json');
              if (scoutRes.ok) setScoutReport(await scoutRes.json());
            } catch (e) {}

            try {
              const connectorRes = await fetch('data/connector-report.json');
              if (connectorRes.ok) setConnectorReport(await connectorRes.json());
            } catch (e) {}

            try {
              const navigatorRes = await fetch('data/navigator-report.json');
              if (navigatorRes.ok) setNavigatorReport(await navigatorRes.json());
            } catch (e) {}

            try {
              const mobilizerRes = await fetch('data/mobilizer-report.json');
              if (mobilizerRes.ok) setMobilizerReport(await mobilizerRes.json());
            } catch (e) {}

            try {
              const strategistRes = await fetch('data/strategist-briefing.json');
              if (strategistRes.ok) setStrategistBriefing(await strategistRes.json());
            } catch (e) {}
          };

          pollData();
          const interval = setInterval(pollData, 2000);
          return () => clearInterval(interval);
        }
      }, [stage]);

      const navigateTo = (newStage) => {
        window.location.hash = newStage;
      };

      const renderStage = () => {
        switch (stage) {
          case 'welcome':
            return <WelcomeStage mission={mission} setMission={setMission} navigateTo={navigateTo} />;
          case 'team':
            return <TeamStage navigateTo={navigateTo} />;
          case 'launch':
            return <LaunchStage state={state} navigateTo={navigateTo} />;
          case 'roadmap':
            return <RoadmapStage mission={mission} navigateTo={navigateTo} />;
          case 'mission':
            return (
              <MissionControlStage
                mission={mission}
                state={state}
                scoutReport={scoutReport}
                connectorReport={connectorReport}
                navigatorReport={navigatorReport}
                mobilizerReport={mobilizerReport}
                strategistBriefing={strategistBriefing}
                setModalOpen={setModalOpen}
                setSelectedApproval={setSelectedApproval}
              />
            );
          default:
            return <WelcomeStage mission={mission} setMission={setMission} navigateTo={navigateTo} />;
        }
      };

      return (
        <>
          {renderStage()}
          {modalOpen && selectedApproval && (
            <ApprovalModal
              approval={selectedApproval}
              onClose={() => setModalOpen(false)}
            />
          )}
        </>
      );
    }

    // Stage 1: Welcome
    function WelcomeStage({ mission, setMission, navigateTo }) {
      const [step, setStep] = useState(0);

      const handleDiseaseSubmit = (e) => {
        e.preventDefault();
        if (mission.disease.trim()) {
          setStep(1);
        }
      };

      const handlePatientRelation = (relation) => {
        setMission({ ...mission, patientRelation: relation });
        setStep(2);
      };

      const handlePatientName = (e) => {
        e.preventDefault();
        if (mission.patientName.trim()) {
          setStep(3);
        }
      };

      const handlePatientAge = (e) => {
        e.preventDefault();
        if (mission.patientAge.trim()) {
          setStep(4);
        }
      };

      const handleDiagnosisDate = (e) => {
        e.preventDefault();
        if (mission.diagnosisDate.trim()) {
          setStep(5);
        }
      };

      const handlePriorities = () => {
        if (mission.priorities.length > 0) {
          setTimeout(() => navigateTo('team'), 500);
        }
      };

      const togglePriority = (priority) => {
        const newPriorities = mission.priorities.includes(priority)
          ? mission.priorities.filter(p => p !== priority)
          : [...mission.priorities, priority];
        setMission({ ...mission, priorities: newPriorities });
      };

      return (
        <div className="stage">
          <div className="container-centered">
            {step === 0 && (
              <>
                <div className="beacon-logo">
                  <div className="beacon-icon">üîÜ</div>
                  <div className="beacon-title">Beacon</div>
                </div>
                <h1>You've just received a diagnosis that changed everything.</h1>
                <p style={{ fontSize: '1.25rem', maxWidth: '600px' }}>
                  We're here to help. Beacon is a team of AI agents that works around the clock to
                  find treatments, connect with researchers, navigate regulatory pathways, and raise funds.
                </p>
                <form onSubmit={handleDiseaseSubmit} style={{ width: '100%', maxWidth: '500px', marginTop: '2rem' }}>
                  <input
                    type="text"
                    className="input-field"
                    placeholder="e.g. CLN3 Batten Disease"
                    value={mission.disease}
                    onChange={(e) => setMission({ ...mission, disease: e.target.value })}
                    autoFocus
                  />
                  <button type="submit" className="btn btn-primary" style={{ width: '100%' }}>
                    Continue
                  </button>
                </form>
              </>
            )}

            {step >= 1 && (
              <div className="intake-question" key="q1">
                <label className="question-label">Who is the patient?</label>
                <div className="button-group">
                  <button className={`btn-option ${mission.patientRelation === 'My child' ? 'selected' : ''}`} onClick={() => handlePatientRelation('My child')}>
                    My child
                  </button>
                  <button className={`btn-option ${mission.patientRelation === 'Myself' ? 'selected' : ''}`} onClick={() => handlePatientRelation('Myself')}>
                    Myself
                  </button>
                  <button className={`btn-option ${mission.patientRelation === 'A family member' ? 'selected' : ''}`} onClick={() => handlePatientRelation('A family member')}>
                    A family member
                  </button>
                </div>
              </div>
            )}

            {step >= 2 && (
              <div className="intake-question" key="q2">
                <label className="question-label">What is their name?</label>
                <form onSubmit={handlePatientName} style={{ width: '100%', maxWidth: '400px' }}>
                  <input
                    type="text"
                    className="input-field"
                    placeholder="Name"
                    value={mission.patientName}
                    onChange={(e) => setMission({ ...mission, patientName: e.target.value })}
                    autoFocus
                  />
                  <button type="submit" className="btn btn-primary" style={{ width: '100%' }}>
                    Continue
                  </button>
                </form>
              </div>
            )}

            {step >= 3 && (
              <div className="intake-question" key="q3">
                <label className="question-label">How old are they?</label>
                <form onSubmit={handlePatientAge} style={{ width: '100%', maxWidth: '400px' }}>
                  <input
                    type="text"
                    className="input-field"
                    placeholder="Age"
                    value={mission.patientAge}
                    onChange={(e) => setMission({ ...mission, patientAge: e.target.value })}
                    autoFocus
                  />
                  <button type="submit" className="btn btn-primary" style={{ width: '100%' }}>
                    Continue
                  </button>
                </form>
              </div>
            )}

            {step >= 4 && (
              <div className="intake-question" key="q4">
                <label className="question-label">When was the diagnosis?</label>
                <form onSubmit={handleDiagnosisDate} style={{ width: '100%', maxWidth: '400px' }}>
                  <input
                    type="text"
                    className="input-field"
                    placeholder="e.g. January 2025"
                    value={mission.diagnosisDate}
                    onChange={(e) => setMission({ ...mission, diagnosisDate: e.target.value })}
                    autoFocus
                  />
                  <button type="submit" className="btn btn-primary" style={{ width: '100%' }}>
                    Continue
                  </button>
                </form>
              </div>
            )}

            {step >= 5 && (
              <div className="intake-question" key="q5">
                <label className="question-label">What matters most right now?</label>
                <div className="checkbox-group" style={{ width: '100%', maxWidth: '400px', alignItems: 'center' }}>
                  <label className="checkbox-label">
                    <input
                      type="checkbox"
                      checked={mission.priorities.includes('Understanding the disease')}
                      onChange={() => togglePriority('Understanding the disease')}
                    />
                    Understanding the disease
                  </label>
                  <label className="checkbox-label">
                    <input
                      type="checkbox"
                      checked={mission.priorities.includes('Finding treatments')}
                      onChange={() => togglePriority('Finding treatments')}
                    />
                    Finding treatments
                  </label>
                  <label className="checkbox-label">
                    <input
                      type="checkbox"
                      checked={mission.priorities.includes('Connecting with families')}
                      onChange={() => togglePriority('Connecting with families')}
                    />
                    Connecting with families
                  </label>
                  <label className="checkbox-label">
                    <input
                      type="checkbox"
                      checked={mission.priorities.includes('All of the above')}
                      onChange={() => togglePriority('All of the above')}
                    />
                    All of the above
                  </label>
                </div>
                <button
                  className="btn btn-primary"
                  style={{ marginTop: '2rem' }}
                  onClick={handlePriorities}
                  disabled={mission.priorities.length === 0}
                >
                  Meet your team ‚Üí
                </button>
              </div>
            )}
          </div>
        </div>
      );
    }

    // Stage 2: Team
    function TeamStage({ navigateTo }) {
      return (
        <div className="stage">
          <div className="container">
            <div className="text-center mb-3">
              <h1>We're assembling your team.</h1>
              <p style={{ fontSize: '1.25rem', color: '#6b7280' }}>
                Five AI agents, each an expert in their domain, working together on your mission.
              </p>
            </div>

            <div className="agent-grid">
              <div className="agent-card scout">
                <div className="agent-icon">üî¨</div>
                <div className="agent-name">Scout</div>
                <div className="agent-role">Your Research Scientist</div>
                <div className="agent-description">
                  Searches the global literature, finds the latest discoveries, and identifies promising treatment approaches.
                </div>
              </div>

              <div className="agent-card connector">
                <div className="agent-icon">ü§ù</div>
                <div className="agent-name">Connector</div>
                <div className="agent-role">Your Medical Liaison</div>
                <div className="agent-description">
                  Finds and reaches out to the world's leading researchers and clinicians working on this disease.
                </div>
              </div>

              <div className="agent-card navigator">
                <div className="agent-icon">üß≠</div>
                <div className="agent-name">Navigator</div>
                <div className="agent-role">Your Regulatory Strategist</div>
                <div className="agent-description">
                  Maps the path from where you are now to a clinical trial. Knows FDA pathways and orphan drug programs.
                </div>
              </div>

              <div className="agent-card mobilizer">
                <div className="agent-icon">üí∞</div>
                <div className="agent-name">Mobilizer</div>
                <div className="agent-role">Your Fundraising Coordinator</div>
                <div className="agent-description">
                  Finds grants, builds fundraising strategy, and connects you with the rare disease community.
                </div>
              </div>

              <div className="agent-card strategist">
                <div className="agent-icon">üéØ</div>
                <div className="agent-name">Strategist</div>
                <div className="agent-role">Your Chief of Staff</div>
                <div className="agent-description">
                  Coordinates the whole team. Makes sure you see the right information at the right time.
                </div>
              </div>
            </div>

            <div className="text-center mt-3">
              <button className="btn btn-primary" onClick={() => navigateTo('launch')} style={{ fontSize: '1.25rem', padding: '1.25rem 3rem' }}>
                Start the mission ‚Üí
              </button>
            </div>
          </div>
        </div>
      );
    }

    // Stage 3: Launch
    function LaunchStage({ state, navigateTo }) {
      const agents = [
        { id: 'scout', icon: 'üî¨', name: 'Scout', color: '#8b5cf6' },
        { id: 'connector', icon: 'ü§ù', name: 'Connector', color: '#ec4899' },
        { id: 'navigator', icon: 'üß≠', name: 'Navigator', color: '#3b82f6' },
        { id: 'mobilizer', icon: 'üí∞', name: 'Mobilizer', color: '#10b981' },
        { id: 'strategist', icon: 'üéØ', name: 'Strategist', color: '#f59e0b' }
      ];

      const allComplete = state?.agents?.every(a => a.status === 'complete');

      useEffect(() => {
        if (allComplete) {
          const timer = setTimeout(() => {
            const btn = document.getElementById('roadmap-btn');
            if (btn) btn.style.display = 'block';
          }, 1000);
          return () => clearTimeout(timer);
        }
      }, [allComplete]);

      return (
        <div className="stage">
          <div className="container">
            <div className="text-center mb-3">
              <h1>üîÜ Beacon ‚Äî Mission Active</h1>
              <p style={{ fontSize: '1.25rem', color: '#6b7280' }}>
                {state?.mission?.disease || 'Your team is working'}
              </p>
            </div>

            <div className="status-grid">
              {agents.map((agent) => {
                const agentState = state?.agents?.find(a => a.id === agent.id);
                const status = agentState?.status || 'idle';
                const updates = agentState?.updates || [];

                return (
                  <div key={agent.id} className="status-panel">
                    <div className="status-header">
                      <div className="status-icon">{agent.icon}</div>
                      <div className="status-info">
                        <h3>{agent.name}</h3>
                        <div className={`status-label ${status === 'working' ? 'working' : ''}`}>
                          {status === 'working' ? agentState.current_task : status === 'complete' ? 'Complete' : 'Initializing'}
                        </div>
                      </div>
                    </div>
                    <ul className="status-updates">
                      {updates.map((update, i) => (
                        <li
                          key={i}
                          className={`status-update ${update.completed ? 'completed' : ''} ${update.type === 'finding' ? 'finding' : ''}`}
                          style={{ animationDelay: `${i * 0.1}s` }}
                        >
                          {i === updates.length - 1 ? '‚îî‚îÄ ' : '‚îú‚îÄ '}
                          {update.completed && '‚úì '}
                          {update.message}
                        </li>
                      ))}
                    </ul>
                  </div>
                );
              })}
            </div>

            <div className="text-center mt-3">
              <button
                id="roadmap-btn"
                className="btn btn-primary"
                onClick={() => navigateTo('roadmap')}
                style={{ display: 'none', fontSize: '1.25rem', padding: '1.25rem 3rem' }}
              >
                View your roadmap ‚Üí
              </button>
            </div>
          </div>
        </div>
      );
    }

    // Stage 4: Roadmap
    function RoadmapStage({ mission, navigateTo }) {
      return (
        <div className="stage">
          <div className="container">
            <div className="text-center mb-3">
              <h1>Your Roadmap</h1>
              <p style={{ fontSize: '1.25rem', color: '#6b7280' }}>
                {mission.disease}
              </p>
            </div>

            <div className="timeline">
              <div className="timeline-phase active">
                <div className="timeline-marker">1</div>
                <div className="timeline-label">NOW</div>
                <div className="timeline-title">Research & Outreach</div>
                <ul className="timeline-milestones">
                  <li>Map disease landscape</li>
                  <li>Identify key researchers</li>
                  <li>Initial outreach</li>
                </ul>
              </div>

              <div className="timeline-phase">
                <div className="timeline-marker">2</div>
                <div className="timeline-label">3 MONTHS</div>
                <div className="timeline-title">Preclinical Planning</div>
                <ul className="timeline-milestones">
                  <li>Target validation</li>
                  <li>Model selection</li>
                  <li>Grant applications</li>
                </ul>
              </div>

              <div className="timeline-phase">
                <div className="timeline-marker">3</div>
                <div className="timeline-label">12 MONTHS</div>
                <div className="timeline-title">IND Filing</div>
                <ul className="timeline-milestones">
                  <li>Orphan drug designation</li>
                  <li>Manufacturing plan</li>
                  <li>FDA pre-IND meeting</li>
                </ul>
              </div>

              <div className="timeline-phase">
                <div className="timeline-marker">4</div>
                <div className="timeline-label">24 MONTHS</div>
                <div className="timeline-title">Clinical Trial</div>
                <ul className="timeline-milestones">
                  <li>Site selection</li>
                  <li>Patient enrollment</li>
                  <li>Trial initiation</li>
                </ul>
              </div>
            </div>

            <div className="priorities-section">
              <h2>This Week's Priorities</h2>
              <ul className="priority-list">
                <li className="priority-item">
                  Review outreach emails to top 5 researchers and approve for sending
                </li>
                <li className="priority-item">
                  Evaluate dual-track strategy: gene therapy vs. small molecule approach
                </li>
                <li className="priority-item">
                  Review and submit Letter of Intent for CZI Rare As One Network grant
                </li>
              </ul>
            </div>

            <div className="text-center mt-3">
              <button
                className="btn btn-primary"
                onClick={() => navigateTo('mission')}
                style={{ fontSize: '1.25rem', padding: '1.25rem 3rem' }}
              >
                Go to Mission Control ‚Üí
              </button>
            </div>
          </div>
        </div>
      );
    }

    // Stage 5: Mission Control
    function MissionControlStage({
      mission,
      state,
      scoutReport,
      connectorReport,
      navigatorReport,
      mobilizerReport,
      strategistBriefing,
      setModalOpen,
      setSelectedApproval
    }) {
      const approvals = state?.approvals || [];
      const newCount = approvals.filter(a => !a.reviewed).length;

      const allFindings = [];

      if (scoutReport?.findings) {
        scoutReport.findings.forEach(f => {
          allFindings.push({
            agent: 'Scout',
            icon: 'üî¨',
            time: '2 hours ago',
            ...f
          });
        });
      }

      if (connectorReport?.contacts) {
        connectorReport.contacts.slice(0, 2).forEach(c => {
          allFindings.push({
            agent: 'Connector',
            icon: 'ü§ù',
            time: '3 hours ago',
            title: `Identified: ${c.name}`,
            summary: c.institution,
            significance: 'High Priority'
          });
        });
      }

      const agents = state?.agents || [
        { id: 'scout', name: 'Scout', icon: 'üî¨', status: 'working', current_task: 'Monitoring new publications' },
        { id: 'connector', name: 'Connector', icon: 'ü§ù', status: 'complete', current_task: 'Draft emails ready' },
        { id: 'navigator', name: 'Navigator', icon: 'üß≠', status: 'complete', current_task: 'Pathway mapped' },
        { id: 'mobilizer', name: 'Mobilizer', icon: 'üí∞', status: 'working', current_task: 'Researching grants' },
        { id: 'strategist', name: 'Strategist', icon: 'üéØ', status: 'complete', current_task: 'Briefing ready' }
      ];

      const handleReview = (approval) => {
        setSelectedApproval(approval);
        setModalOpen(true);
      };

      return (
        <>
          <div className="header-bar">
            <div className="header-title">
              <span className="header-icon">üîÜ</span>
              <span>Beacon ‚Äî {mission.disease || 'Mission Control'}</span>
            </div>
            {newCount > 0 && (
              <div className="notification-badge">
                üîî {newCount} new
              </div>
            )}
          </div>

          <div className="mission-control">
            {approvals.length > 0 && (
              <div className="attention-section">
                <h2>Needs Your Attention</h2>
                <div className="approval-cards">
                  {approvals.map((approval, i) => (
                    <div key={i} className="approval-card">
                      <div className="approval-info">
                        <div className="approval-badge">{approval.type}</div>
                        <div className="approval-title">{approval.title}</div>
                        <div className="approval-summary">{approval.summary}</div>
                      </div>
                      <button className="btn btn-primary btn-small" onClick={() => handleReview(approval)}>
                        Review ‚Üí
                      </button>
                    </div>
                  ))}
                </div>
              </div>
            )}

            <div className="main-grid">
              <div className="feed-section">
                <h2>Recent Discoveries</h2>
                <div className="feed-items">
                  {allFindings.length > 0 ? (
                    allFindings.map((finding, i) => (
                      <div key={i} className="feed-item" style={{ animationDelay: `${i * 0.1}s` }}>
                        <div className="feed-header">
                          <span>{finding.icon}</span>
                          <span className="feed-agent">{finding.agent}</span>
                          <span className="feed-time">{finding.time}</span>
                        </div>
                        <div className="feed-title">{finding.title}</div>
                        <div className="feed-summary">{finding.summary}</div>
                        {finding.significance && (
                          <div className="significance-badge">{finding.significance}</div>
                        )}
                      </div>
                    ))
                  ) : (
                    <div className="feed-item">
                      <div className="feed-header">
                        <span>üî¨</span>
                        <span className="feed-agent">Scout</span>
                        <span className="feed-time">1 hour ago</span>
                      </div>
                      <div className="feed-title">TRPML1 Channel Activation Shows Promise</div>
                      <div className="feed-summary">
                        New paper demonstrates lysosomal calcium channel activation as potential therapeutic target for CLN3 disease.
                      </div>
                      <div className="significance-badge">High Impact</div>
                    </div>
                  )}
                </div>
              </div>

              <div className="agent-status-section">
                <h2>Agent Status</h2>
                <div className="agent-status-list">
                  {agents.map((agent) => (
                    <div key={agent.id} className="agent-status-row">
                      <div className={`status-dot ${agent.status}`}></div>
                      <div className="agent-status-info">
                        <div className="agent-status-name">
                          {agent.icon} {agent.name}
                        </div>
                        <div className="agent-status-task">{agent.current_task}</div>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            </div>

            <div className="progress-section">
              <h2>Roadmap Progress</h2>
              <div className="progress-bars">
                <div className="progress-bar-item">
                  <div className="progress-label">
                    <span>Research & Literature Mapping</span>
                    <span>73%</span>
                  </div>
                  <div className="progress-bar-bg">
                    <div className="progress-bar-fill" style={{ width: '73%' }}></div>
                  </div>
                </div>
                <div className="progress-bar-item">
                  <div className="progress-label">
                    <span>Researcher Outreach</span>
                    <span>45%</span>
                  </div>
                  <div className="progress-bar-bg">
                    <div className="progress-bar-fill" style={{ width: '45%' }}></div>
                  </div>
                </div>
                <div className="progress-bar-item">
                  <div className="progress-label">
                    <span>Regulatory Pathway Mapping</span>
                    <span>82%</span>
                  </div>
                  <div className="progress-bar-bg">
                    <div className="progress-bar-fill" style={{ width: '82%' }}></div>
                  </div>
                </div>
              </div>
              <div style={{ textAlign: 'center', marginTop: '1.5rem' }}>
                <a href="#roadmap" style={{ color: '#d97706', fontWeight: 600, textDecoration: 'none' }}>
                  View full roadmap ‚Üí
                </a>
              </div>
            </div>
          </div>

          <div className="chat-input-section">
            <div className="chat-input-wrapper">
              <input
                type="text"
                className="chat-input"
                placeholder="Ask your team anything..."
              />
              <button className="btn btn-primary">Send</button>
            </div>
          </div>
        </>
      );
    }

    // Approval Modal
    function ApprovalModal({ approval, onClose }) {
      const [editedApproval, setEditedApproval] = useState({ ...approval });

      const handleApprove = () => {
        console.log('Approved:', editedApproval);
        alert('Email approved and queued for sending!');
        onClose();
      };

      return (
        <div className="modal-overlay" onClick={onClose}>
          <div className="modal" onClick={(e) => e.stopPropagation()}>
            <div className="modal-header">
              <h2 className="modal-title">Review & Approve</h2>
              <button className="modal-close" onClick={onClose}>√ó</button>
            </div>

            <div className="modal-field">
              <label className="modal-label">To:</label>
              <input
                type="text"
                className="modal-input"
                value={editedApproval.to || ''}
                onChange={(e) => setEditedApproval({ ...editedApproval, to: e.target.value })}
              />
            </div>

            <div className="modal-field">
              <label className="modal-label">Subject:</label>
              <input
                type="text"
                className="modal-input"
                value={editedApproval.subject || editedApproval.title}
                onChange={(e) => setEditedApproval({ ...editedApproval, subject: e.target.value })}
              />
            </div>

            <div className="modal-field">
              <label className="modal-label">Message:</label>
              <textarea
                className="modal-textarea"
                value={editedApproval.body || editedApproval.content || ''}
                onChange={(e) => setEditedApproval({ ...editedApproval, body: e.target.value })}
              />
            </div>

            {approval.note && (
              <div className="modal-note">
                <div className="modal-note-label">Connector's Note:</div>
                <div className="modal-note-text">{approval.note}</div>
              </div>
            )}

            <div className="modal-actions">
              <button className="btn btn-approve" onClick={handleApprove}>
                Approve & Send
              </button>
              <button className="btn btn-primary btn-small" onClick={() => alert('Edits saved!')}>
                Save Edits
              </button>
              <button className="btn btn-cancel btn-small" onClick={onClose}>
                Cancel
              </button>
            </div>
          </div>
        </div>
      );
    }

    // Render App
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
